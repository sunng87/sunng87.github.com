
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>车水马龙</title>
  <meta name="author" content="Sun Ning">

  
  <meta name="description" content="This article will show you some basic steps to setup a standalone environment for Jython, with the power of some popular and standard tools. 0. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sunng87.github.io/blog//blog/page/16">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="车水马龙" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">车水马龙</a></h1>
  
    <h2>here comes the sun</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sunng87.github.io/blog/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/12/30/setup-a-jython-development-environment/">Setup a Jython Development Environment</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-30T00:00:00+08:00" pubdate data-updated="true">Dec 30<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This article will show you some basic steps to setup a standalone environment for Jython, with the power of some popular and standard tools.</p>

<p><h3>0. Install essential tools</h3>
Take Ubuntu Maverick as an example, before starting, you have to make sure these packages installed on your system.</p>

<p><strong>Essential Python tools</strong> (Python is shipped with most Linux distribution by default)
<i>sudo apt-get install python-pip python-virtualenv</i></p>

<p><strong>Java</strong>
<i>sudo apt-get install openjdk-6-jdk openjdk-6-jre</i></p>

<p><strong>Jython</strong>
The Jython package in Ubuntu repository is obsolete. Download Jython installer from official website. A full installation is recommended here.
<a href="http://jython.org/downloads.html">http://jython.org/downloads.html</a></p>

<p>As an optional step, I often move Jython direcotry to /usr/local/share/ , and use a symbol link to add Jython to PATH:
<i>sudo ln -s /usr/local/share/jython/bin/jython /usr/local/bin/</i></p>

<p><strong>Install additional Java tools</strong>
<i>sudo apt-get install ant ivy</i></p>

<p><h3>1. Create a standalone environment</h3>
Jython 2.5 is fully compatible with virtualenv, so you can create a standalone environment just like what you do with python:
<i>virtualenv -p /usr/local/bin/jython jython-env</i>
<i>cd jython-env</i></p>

<p>List the directory, you will see these files and directories:
<ul>
<li>bin/</li>
<li>cachedir/</li>
<li>Lib/</li>
<li>jython.jar</li>
<li>registry</li>
</ul>
Source the activate script:
<i>source bin/activate</i></p>

<p><h3>2. Download and install python packages</h3>
Now the python environment is just ready, you can install python packages as you want. Install bottle, for example:
<i>pip install bottle</i></p>

<p><h3>3. Download and install Java dependencies</h3>
This is the different step. As you know, the most important feature of Jython is availability of Java libraries to Python code. So we need some additional tools to manage Java dependencies. Popular Java lifecycle management tool <strong>Maven</strong> is not suitable here, because Maven is tightly depends on its archetype. <strong>Gradle</strong> is also known as a powerful build tool with DSL support. However, Gradle uses Groovy as the scripting language to create build file. Bringing Groovy to a Jython project seems terribly strange.</p>

<p>So I prefer the traditional Ant way to manage dependencies. First of all, create a build file with following content:
<strong>build.xml</strong>
[cc lang=&#8221;xml&#8221;]
<project xmlns:ivy="antlib:org.apache.ivy.ant" name="jython-env" default="resolve">
    <target name="resolve" description="retrieve dependencies">
        <ivy:retrieve pattern="javalib/[artifact]-[revision].[ext]" type="jar" />
    </target>
</project>
[/cc]</p>

<p>Then create an ivy xml to configure dependencies:
<strong>ivy.xml</strong>
[cc lang=&#8221;xml&#8221;]
<ivy-module version="2.0">
    <info organisation="info.sunng" module="jython-env" />
    <dependencies>
        <dependency org="commons-lang" name="commons-lang" rev="2.5" />
    </dependencies>
</ivy-module>
[/cc]</p>

<p>Also, as an optional step, you can overwrite default settings to configure ivy to use maven local repository.
<strong>ivysettings.xml</strong>
[cc lang=&#8221;xml&#8221;]
<ivy-settings>
    <settings defaultresolver="maven-or-not" />
    <resolvers>
        <chain name="maven-or-not" returnfirst="true">
            <filesystem name="maven-local" m2compatible="true" />
            <ibiblio name="ibiblio" m2compatible="true" />
        </chain>
    </resolvers>
</ivy-settings>
[/cc]</p>

<p>All done, now you can download everything. In Ubuntu, default ivy installation, you have to specify ivy path in ant command line:
<i>ant -lib /usr/share/java/ivy.jar</i></p>

<p>You will see jars in <i>javalib</i>.</p>

<p><h3>4. Reconfigure start up script</h3>
The default Jython start up script is not friendly to external Java dependencies. To include jars, you have to use such dirty command line parameters:
<i>jython -Dpython.path=javalib/commons-lang-2.5.jar:javalib/&#8230;</i></p>

<p>To get rid of this, first rename bin/jython to bin/startJython. (Follow the Groovy naming convention)</p>

<p>Then create a new bin/jython script wraps the old one:<br />
[cc lang=&#8221;bash&#8221;]<br />
#! /bin/bash</p>

<p>JYTHON_CMD=&#8221;startJython&#8221;<br />
JAVA_LIBS=&#8221;javalib/*.jar&#8221;<br />
PYTHON_PATH=&#8221;&#8221;</p>

<p>for lib in $JAVA_LIBS<br />
do<br />
    PYTHON_PATH=&#8221;$PYTHON_PATH:$lib&#8221;<br />
done</p>

<p>#echo $PYTHON_PATH<br />
$JYTHON_CMD -Dpython.path=$PYTHON_PATH</p>

<p>[/cc]</p>

<p><h3>5. Run</h3>
Finally, it comes to an end. Type jython to execute the interactive shell:
<i>jython</i>
<blockquort>
Jython 2.5.1 (Release_2_5_1:6813, Sep 26 2009, 13:47:54)<br />
[OpenJDK Server VM (Sun Microsystems Inc.)] on java1.6.0_20<br />
Type &#8220;help&#8221;, &#8220;copyright&#8221;, &#8220;credits&#8221; or &#8220;license&#8221; for more information.<br />
>>> from org.apache.commons.lang import BitField<br />
>>> import bottle
</blockquort></p>

<p>Both Python and Java dependency is accessible. Now it&#8217;s time to get your new start.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/12/28/my-first-http-server-soldat-http/">My First Http Server, Soldat-http</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-28T00:00:00+08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>2008年的冬天，有一天和一个不认识的网友聊天，他说，以前也对这些框架啦什么的感兴趣，后来就变了，他说他当时的目标是写一个HTTP服务器。我当时能够认同他的观点，不过没什么特别的共鸣。到了今天春天，项目开始了，周末老大休假回杭州，留下大伙大眼瞪小眼要联调。出现了问题发现自己一窍不通，然后开玩笑说一定要把老大的NIO框架看懂才跳槽。结果不幸还没来得及怎么看就闪人了，还好老大<a href="http://code.google.com/p/amoeba/">开源</a>，现在依然还可以偷偷看看。另外，我还隐约记得09年冬天的时候，似乎也给自己定过个类似一年之内写个HTTP服务器之类的目标。</p>

<p>所以我说，自己写程序是一件<a href="http://blog.samsonis.me/2010/12/wordpress-%e8%b1%86%e7%93%a3%e6%8f%92%e4%bb%b6-douban-collections-%e8%b1%86%e7%93%a3%e6%94%b6%e8%97%8f-0-9-0/#comment-1299">情怀驱动</a>的事情：就像<a href="http://blog.samsonis.me/">有些同学</a>一再强调自己再也不写<a href="http://wordpress.org/extend/plugins/douban-collections/">wordpress插件</a>了，可是还是不断有<a href="http://blog.samsonis.me/2010/12/wordpress-%E8%B1%86%E7%93%A3%E6%8F%92%E4%BB%B6-douban-collections-%E8%B1%86%E7%93%A3%E6%94%B6%E8%97%8F-0-9-0/">新版本发布</a>。</p>

<p>好吧，其实这个目标最后没有实现。目前这个版本仅仅是能够work，在2010年快要结束的时候赶紧把他搬出来，聊以自慰，嗯，我这一年不是一无所获。
<a href="http://www.flickr.com/photos/40741608@N08/5300136156/" title="Screenshot - 12282010 - 09:17:59 PM by 贝小塔, on Flickr"><img src="http://farm6.static.flickr.com/5124/5300136156_7a29dfb2f9.jpg" width="500" height="396" alt="Screenshot - 12282010 - 09:17:59 PM" /></a></p>

<p>接下来我还会进一步完善它和底层的事件驱动框架，还有意完成一个Jython的WSGI实现。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/12/24/lm-tooling-2010/">LM Tooling, 2010</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-24T00:00:00+08:00" pubdate data-updated="true">Dec 24<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>阿哈，大家都开始总结2010年了，我也想找个角度来总结一下今年。三句不理老本行，还是聊软件开发周边的事情。Lifecycle Management Tooling，软件生命周期管理的工具和我一年的感受。</p>

<p>一月份的时候我还有大把的业余时间，在做一个叫做<a href="https://bitbucket.org/sunng/yan">Yan</a>的验证码服务。这个项目从我刚一到盛大工作就开始了，不过因为没有特别的需求，最后变成了自己的开源项目。这个项目用Maven做dependency management，用hg做版本控制，代码放在bitbucket上。它对Maven的使用还很基本，是一个Single Module的小项目，因为服务本身已经实现了插件机制，本来我准备把它拆成Multimodule的Maven工程来着，不过后来因为比较忙，这件事就放掉了。那时我已经开始尝试用hg进行分支管理、每个release打tag，甚至还有一段时间会有一些两个分支的并行开发。这些基本上是实验性质的尝试，不过和后来相比也算是做的比较规范的了。</p>

<p>三月份我注册了github，顺带就开始用git了。到目前为止，我对hg和git的区别还没有特别的感受，选择的主要依据其实bitbucket和github。相对social一些的项目，github是当仁不让的选择。bitbucket上人少比较清净，一些incubator项目放在上面，烂尾了也不至于太丢脸。扯远了，哈哈。</p>

<p>之后我们开始做一个规模比较大的项目，我们使用Maven，使用Nexus，使用SVN。项目规模比较大，我们有数个Multimodule的Maven项目，遇到的第一个问题就是集成的成本非常大。最初几周，我都是在自己的机器上做集成，Windows，你懂的，又不太方便做自动化，结果整个过程非常痛苦。到了四月份项目还没有全部完成，已经不能忍了，于是我引入了Hudson。我们为每一个项目创建单独的build task，unstable的构建会有邮件通知开发人员。一方面把我从每天反复的手动集成打包中解脱出来，另一方面也促进了大家写高质量的UnitTest，因为一旦有测试不通过就会有一个虚构的200000000@snda.com的邮箱给大家发邮件，以至于最后几乎所有人都把这个地址拉黑了。</p>

<p>写真正能够Automation的单元测试其实很不简单，尤其是DAL层。理想的solution是用内存数据库来做单元测试的数据源，不过在实际开发里，因为一些SQL会依赖特定的数据库，所以这个方案并不太理想。如果有事务的话，Spring的TestCase可以设置自动回滚，可是互联网项目，你也懂的，连一致性都搞成最终一致了，事务这么重的东西我们是不用的。</p>

<p>我们遇到的另一个问题是，多个独立的Maven项目，在做集成时，会存在依赖的冲突。这类问题一旦出现，找原因的代价还是比较大的。这方面，老大有一个Best Practice，定义一个统一的、专门管理版本的pom，通过dependency management的import来使用，你可以<a href="http://sunng.info/blog/2010/05/maven-recipe-0/">看这里</a>来了解。</p>

<p>我们suffer的另一个问题是SVN的分支管理，到了项目的后期，功能越来越多，也出现了两个分支的并行开发，回滚的情况也出现了。我们基本上可以保证每次发布都有tag，但是分支的管理实在是非常痛苦。我现在的认识是，两方面原因。第一，SVN的分支成本还是比较高的，远程整个目录拷贝一下，本地需要指向新的地址。第二，项目的计划不明确，根本没有办法去估计新的分支、新的版本。两个原因结合起来说，其实分支管理不完全是一个版本控制系统层面的问题，和整个项目规划都有一定的联系。</p>

<p>到了后期，我们对Hudson的使用也有了一些最佳实践，结合ssh/scp的插件，task的trigger机制，我们有了自动化的部署，你可以在<a href="http://sunng.info/blog/2010/09/hudson-tips/">这里</a>了解。不过我们的自动化最后倒在公司强制的动态密码验证机制上，每次登录需要使用动态密码，这样一切最后又都回归了手动。</p>

<p>除了在公司的项目，在9月份我又做了一个实验性的项目，叫做<a href="https://github.com/sunng87/bason">Bason</a>，他可以在编译时生成JavaBean到Mongodb BSON代码。也是用Maven管理，不过值得一提的是，我申请了Sonatype提供的<a href="https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide">OSS Repository</a>，这样可以把项目都deploy到公共的服务器上，使用会非常方便。还值得一提的是，OSS Repository的管理者是校友<a href="http://www.juvenxu.com/">@Juvenxu</a></p>

<p>不过今年Maven并不是Java生命周期管理的唯一工具，还有一些工具也开始进入视线，当然我说的不是ant+ivy。前段时间发布0.9的<a href="http://gradle.org/">Gradle</a>是比较受关注的，它又回归了ant的task oriented ，结合Groovy的DSL和插件机制提供更高的灵活性。另外，断断续续学了一年的clojure，clojure的生态系统里已经有了一个叫做<a href="https://github.com/technomancy/leiningen">leinigen</a>的生命周期管理工具，在clojure的世界里，它非常好用。</p>

<p>另外Python的世界，我逐渐开始强制自己用virtualenv来创建一个更可控，更具有移植性的python环境。随着年底开始的一个小项目，我应该对python项目的生命周期管理有更深的认识。</p>

<p>年底到了SAP，开始在NetWeaver平台上做Abap开发。NetWeaver是一个复杂的平台，它的Scope也涵盖了生命周期管理。在NetWeaver中，开发一个非local的程序，需要首先创建一个Change Request，之后所有的变更，最后都会保存到这个ChangeRequest上，有些类似传统的分支。当开发完成后，开发人员把change request release掉，这部分代码会自动被transport到Test系统或者其他下游系统上。实际开发里，一个Change Request可能对应一个Ticket，一个特性。这样的平台上，开发人员需要额外操心的事情，非常少。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/12/21/exaile-doubanfm-plugin-0-0-6b/">Exaile Doubanfm Plugin 0.0.6b</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-21T00:00:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>上周豆瓣电台增加了电影原声频道，这次的插件更新支持了这个新频道（OST）。</p>

<p>下载地址<br />
https://github.com/sunng87/exaile-doubanfm-plugin/downloads</p>

<p>安装指南<br />
https://github.com/sunng87/exaile-doubanfm-plugin/wiki/Installation</p>

<p>欢迎使用！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/12/19/blackboard-pattern/">Blackboard Pattern</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-19T00:00:00+08:00" pubdate data-updated="true">Dec 19<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>昨天很虔诚地在图书馆把POSA第四卷里所有的Pattern Languages都抄了一遍。恰好遇到Modeling部分的第9个Pattern， Blackboard，没有感性认识。今天简单地搜索了一下。</p>

<p>POSA上指出Blackboard模式用于解决尚没有绝对解决方案的问题，将几个子系统的知识组合起来提供一个近似的解决方案。在解决这类问题的过程中，几个子系统相互独立，Blackboard作为中央控制对子系统进行控制和反馈。在这个系统中有三个角色：
<ul>
<li>Control Shell: 系统对外的控制接口</li>
<li>Blackboard: 中央的知识管理，接受Specialist运算的反馈，对Specialist进行调度</li>
<li>Specialist: 具有专业知识的子系统，负责独立的运算</li>
</ul></p>

<p>这里有一个描述Blackboard模式的代码例子：
<a href="http://www.andypatterns.com/index.php/blog/blackboard_architectural_pattern/">http://www.andypatterns.com/index.php/blog/blackboard_architectural_pattern/</a></p>

<p>参考：<br />
http://www.vico.org/pages/PatronsDisseny/Pattern%20Blackboard/<br />
http://en.wikipedia.org/wiki/Blackboard_system<br />
http://chat.carleton.ca/~narthorn/project/patterns/BlackboardPattern-display.html</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/12/14/for-12-13/">For 12.13</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-14T00:00:00+08:00" pubdate data-updated="true">Dec 14<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For people of Nanjing, <a href="http://en.wikipedia.org/wiki/Nanking_Massacre">December 13th</a> is a day that they can never forget.</p>

<p>The memorial hall of the victims in Nanjing massacre.</p>

<p><iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://www.openstreetmap.org/export/embed.html?bbox=118.73284,32.03447,118.74073,32.039&amp;layer=mapnik" style="border: 1px solid black"></iframe><br /><small><a href="http://www.openstreetmap.org/?lat=32.036735&amp;lon=118.736785&amp;zoom=16&amp;layers=M">View Larger Map</a></small></p>

<p>The <a href="http://en.wikipedia.org/wiki/John_Rabe">John Rabe</a> house</p>

<p><iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://www.openstreetmap.org/export/embed.html?bbox=118.77623,32.05136,118.780172,32.053625&amp;layer=mapnik" style="border: 1px solid black"></iframe><br /><small><a href="http://www.openstreetmap.org/?lat=32.0524925&amp;lon=118.778201&amp;zoom=17&amp;layers=M">View Larger Map</a></small></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/12/11/douban-is-now-available-as-a-cover-provider-of-covergloobus/">Douban Is Now Available as a Cover Provider of CoverGloobus</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-11T00:00:00+08:00" pubdate data-updated="true">Dec 11<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a feature requested by <a href="http://www.douban.com/people/4350866/">a douban user</a>, we need a provider for <a href="https://launchpad.net/covergloobus">CoverGloobus</a> to retrieve covers from douban.com</p>

<p>I just modify the code of exaile-douban-cover, and adapt to CoverGloobus 1.7 API. In 1.7, CoverGloobus has simplfied SPI for cover providers, which has much enhancement from 1.6 . So this provider is only compatible with CoverGloobus 1.7 .</p>

<p>The patch is now merged into the bazaar repository, you can find it at:<br />
http://bazaar.launchpad.net/~gloobus-dev/covergloobus/trunk/files/head%3A/src/covers/</p>

<p>Chinese user will benefit from this patch that CoverGloobus will try to download album art if it&#8217;s not available from your music player.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/12/07/%E6%AC%A2%E8%BF%8E%E5%8A%A0%E5%85%A5osm%E4%B8%AD%E6%96%87%E9%82%AE%E4%BB%B6%E5%88%97%E8%A1%A8/">欢迎加入OSM中文邮件列表</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-07T00:00:00+08:00" pubdate data-updated="true">Dec 7<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>大家好，欢迎加入OSM中文邮件列表。现在OSM的中文用户、贡献者终于有一个交流平台了，在 OSM地图编辑的过程中，大家一定遇到过非常多的问题，今后可以在邮件列表中共同探讨了。</p>

<p>周一我在决定邀请一些用户加入列表之前，了解了一下国内OSM贡献者的情况。这个过程其实非常简单，也非常有趣，我查看了包括上海、苏州、杭 州、南京、北京、青岛、济南、沈阳、广州、合肥等几个城市的地图作者，管中窥豹，向几名其中非常活跃的中文用户发出了邀请。同时我也发现有一 些用户曾经非常活跃，但是最近一段时间提交的次数比较少，OSM是一个巨大、繁琐的工作，持续的贡献需要兴趣也需要恒心，过去大家孤军奋战， 因为一些原因很容易放弃这项工作，这次有了中文邮件列表，希望这个平台对OSM贡献者也能起到一个促进的作用，让制图更加有趣。</p>

<p>自我介绍，我的OSM用户名是Sunng，从2008年开始关注OSM，不过到了今年上半年才开始提交地图，我主要在南京、上海活动，目前也 主要关注这两个地方的制图。我在Linux上使用Merkaator作为编辑器，数据来源主要是卫星地图和一个GPS Logger。</p>

<p>上周，随着OSM的创始人Steve Coasts加入Bing，OSM和Bing的合作全面开始，社区动作非常快，目前Poltach2/JOSM/Merkaator等编辑器已经都支持以 Bing卫星地图为底图的编辑模式。这对中国贡献者来说是一个巨大的福音：Ｂing地图的分辨率要远高于之前Ｙahoo提 供的卫星地图。今后以卫星地图为数据源的制图工作会更加轻松、质量会更高。</p>

<p>再提一个有趣的事情，我在浏览地图时，发现湖南南部的行政区数据明显比别处多，下载了数据才了解这是用户 wangchun(http://www.openstreetmap.org/user/wangchun) 的作品。 wangchun是OSM中国的活跃贡献者，他维护了很多铁路数据，此外，还包括钓鱼岛边界的这次编辑 (http://www.openstreetmap.org/browse/changeset/3937490)</p>

<p>抛砖引玉，希望大家在OSM邮件列表上畅所欲言。也希望大家邀请身边的OSM用户、贡献者、潜在用户、潜在贡献者加入邮件列表，让OSM 中国社区更加壮大！</p>

<p>$$$$$$$$$$$$$$$$$$$$$酱油分割线$$$$$$$$$$$$$$$$$$$$$</p>

<p>OpenStreetMap(osm.org)是一个以Wiki方式绘制全球街道地图的项目，这个项目的所有数据都来自志愿者贡献，并以CC-BY-SA许可开放所有的地图和原始数据。<br />
OpenStreetMap在国内也有一批贡献者，很多贡献可以追溯到2007年。目前，上海、杭州、北京的OSM已经初具规模，不过更多的城市需要志愿者加入。</p>

<p>于是在这里邀请您成为OSM的贡献者，并加入到中文邮件列表的讨论中来(http://lists.openstreetmap.org/listinfo/talk-cn)。</p>

<p>成为OSM的贡献者，你可以以这篇Wiki作为基础教程：<br />
http://wiki.openstreetmap.org/wiki/Zh-hans:Beginners_Guide</p>

<p>设备？<br />
您可能需要一个GPS设备，但是这不是必须的。还可以通过对卫星地图进行数字化的方式参与到这项工作中，最近，OSM与Bing地图进行了合作，在国内也有了较高分辨率的卫星影像作底图。</p>

<p>软件？<br />
OSM有很多编辑器，您可以从Potlatch/JOSM/Merkaator等工具中选择一个。</p>

<p>制图？<br />
你需要了解一些基本的制图规范。OSM数据的基础单元是点、线和关系，您可以在这里找到所有的要素类型：<br />
http://wiki.openstreetmap.org/wiki/Map_Features<br />
也可以参考已有的数据，更可以在邮件列表中进行相关的讨论。</p>

<p>欢迎你成为OSM的贡献者，加入到开放地图贡献者的行列中来！</p>

<p>$$$$$$$$$$$$$$$$$$$$$酱油分割线$$$$$$$$$$$$$$$$$$$$$</p>

<p>写了一晚上就写出这两段字来，现在不写大段文字表达能力迅速退化。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/12/03/i-am-location-aware/">I Am Location Aware</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-03T00:00:00+08:00" pubdate data-updated="true">Dec 3<span>rd</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>身为一个跟GIS沾过边的人，我直到今年才真正知道我在哪。尽管有了带GPS功能的手机，但是为了能离cartographer更进一步，今天我又买了一个专门的GPS Logger设备Holux M1000C。所谓GPS Logger就是以固定时间间隔采集GPS数据并记录的设备，现在国内的绝大多数GPS设备都是以导航为主，少有这样功能简单价格合理的GPS产品。
<a href="http://www.flickr.com/photos/40741608@N08/5229058140/" title="DSC_0006 by 贝小塔, on Flickr"><img src="http://farm6.static.flickr.com/5249/5229058140_cb0e8e44a2.jpg" width="500" height="335" alt="DSC_0006" /></a></p>

<p>这类设备，自带的软件当然都是Windows only的，不过在Linux上也不是没有办法。处理GPS数据最著名的工具叫做BT747，支持多种设备、格式，用Java写的，可以通过jnlp启动，quick and dirty一下还是很不错的。不过如果要找一个长相厮守的命令行工具，还是要用gpsbabel。</p>

<p>以USB连接为例，将M1000C通过USB线连接到电脑，开启设备。可以用dmesg命令查看连接的USB设备，找到该设备（我的机器上设备叫做 /dev/ttyACM0）。M1000C使用的是MTK芯片，gpsbabel的命令为：
<i>gpsbabel -t -i m241 -f /dev/ttyACM0 -o gpx -F output.gpx</i></p>

<p>其中：
<ul>
<li>-t 表示track</li>
<li>-i 输入格式，可以带参数如 -i m241,erase=1 表示导入并擦除设备上的数据</li>
<li>-f 输入设备</li>
<li>-o 输出格式，导出gpx格式</li>
<li>-F 输出文件</li>
</ul></p>

<p>有了GPS设备，现在可以名正言顺地为OpenStreetMap贡献了，今天揣着设备把下班的路记录了一下，而且还专门走了小区后面没有路灯的一条路上采集了一下数据，没有路灯还真有点&#8230;
<a href="http://www.flickr.com/photos/40741608@N08/5228648495/" title="merkator by 贝小塔, on Flickr"><img src="http://farm6.static.flickr.com/5043/5228648495_accb4185cc.jpg" width="500" height="313" alt="merkator" /></a></p>

<p><iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://www.openstreetmap.org/export/embed.html?bbox=121.62538,31.19607,121.64143,31.20659&amp;layer=mapnik" style="border: 1px solid black"></iframe><br /><small><a href="http://www.openstreetmap.org/?lat=31.20133&amp;lon=121.633405&amp;zoom=15&amp;layers=M">View Larger Map</a></small></p>

<p>来吧，加入到OpenStreetMap的贡献者队伍里吧！</p>

<p>The post is brought to you by <a href="http://fedorahosted.org/lekhonee">lekhonee</a> v0.7</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/11/29/dbus-python-in-case-you-dont-know/">Dbus-python, in Case You Don&#8217;t Know</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-29T00:00:00+08:00" pubdate data-updated="true">Nov 29<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>上周用dbus-python写exaile插件，实现mpris2.0，非常痛苦，因为几乎没有完整的文档，只有一个<a href="http://dbus.freedesktop.org/doc/dbus-python/doc/tutorial.html">tutorials</a>帮助你入门。总结一下我这次quick and dirty的开发所掌握的资料，当然，因为没有太多时间，所以也没有对dbus做更深入的了解，仅仅是in case you don&#8217;t know。</p>

<p><h3>DBus Interface Properties</h3>
对mpris 2.0中定义的properties用dbus-python应该如何实现呢，似乎没有@dbus.service.properties这种decorator啊。<a href="http://dbus.freedesktop.org/doc/dbus-specification.html#standard-interfaces-properties">这里</a>的文档对Properties进行了简单的说明，对于python程序，只能这样实现了：<br />
[cc lang=&#8221;python&#8221;]<br />
    @dbus.service.method(dbus.PROPERTIES_IFACE, in_signature=&#8217;ss&#8217;, out_signature=&#8217;v&#8217;)<br />
    def Get(self, interface, prop):<br />
        &#8230;<br />
    @dbus.service.method(dbus.PROPERTIES_IFACE, in_signature=&#8217;ssv&#8217;)<br />
    def Set(self, interface, prop, value):<br />
        &#8230;<br />
    @dbus.service.method(dbus.PROPERTIES_IFACE, in_signature=&#8217;s&#8217;, out_signature=&#8217;a{sv}&#8217;)<br />
    def GetAll(self, interface):<br />
        &#8230;<br />
[/cc]<br />
程序里通过prop判断property名字，返回结果。没办法，就是这样。</p>

<p><h3>指定返回数据的dbus类型</h3>
对于dbus接口返回的variant类型，dbus-python会guess_signature。可是这部分的功能有的时候并不如我们想象，比如返回一个dict类型，其中的value有字符串有list有int，而out_signature是v。这种情况在Property Get的时候非常常见，如果不能手动指定类型，guess_signature得到的结果，value是统一类型，即，int会报错，如果没有int类型，会将所有字符串转成list（dbus的array）</p>

<p>这种情况需要手动指定返回的类型，用dbus.types模块下的类型对python显示包装，对dict类型，需要用dbus.types.Dictionary()包装，并且在构造函数里传入signature=&#8217;sv‘及相应的<a href="http://dbus.freedesktop.org/doc/dbus-python/doc/tutorial.html#container-types">variant_level</a>即可显示告知类型。同样，对list对象，需要用dbus.types.Array()包装。</p>

<p>这样即可绕过guest_signature，如果用dbus-monitor查看，就可以看到类型为variant string了。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/blog/page/17/">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/blog/page/15/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2013/07/05/grunt-for-requirejs-projects/">Grunt for Requirejs Projects</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/06/29/%E7%BB%99-raspberry-pi-%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%98%BE%E7%A4%BA-ip-%E7%9A%84%E6%B6%B2%E6%99%B6%E5%B1%8F/">给 Raspberry Pi 添加一个显示 IP 的液晶屏</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/06/07/%E7%BA%B8%E4%B8%8A%E5%BE%97%E6%9D%A5%E7%BB%88%E8%A7%89%E6%B5%85/">纸上得来终觉浅</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/04/24/checkout-ring-adapter-for-jetty-9/">Checkout Ring Adapter for Jetty 9</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/04/12/ann-handlebars-clojure-api/">[ANN] Handlebars Clojure API</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/sunng87">@sunng87</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sunng87',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/classicing?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/classicing">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Sun Ning -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sunng-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
