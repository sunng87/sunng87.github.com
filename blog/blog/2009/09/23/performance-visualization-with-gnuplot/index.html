
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Performance Visualization with Gnuplot - 车水马龙</title>
  <meta name="author" content="Sun Ning">

  
  <meta name="description" content="Gnuplot is considered to be one of the most famous plotting tools on both linux and windows. With Gnuplot, generation of charts becomes agile and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sunng87.github.io/blog//blog/2009/09/23/performance-visualization-with-gnuplot">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="车水马龙" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">车水马龙</a></h1>
  
    <h2>here comes the sun</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sunng87.github.io/blog/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Performance Visualization With Gnuplot</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-23T00:00:00+08:00" pubdate data-updated="true">Sep 23<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Gnuplot is considered to be one of the most famous plotting tools on both linux and windows. With Gnuplot, generation of charts becomes agile and easy. Gnuplot supports sorts of terminals range from gui, image to printer. To enable png terminal support, we will build gnuplot with following steps. (However, on most linux distributions you don&#8217;t have to do these manually, install gnuplot with package manager is doubtlessly the best choice for most cases.)</p>

<p>Well, for a naked machine, it won&#8217;t be too long to type commands in gnuplot.
<h3>Installing libpng</h3>
linpng provides functionality to write png images.<br />
Grab source form libpng&#8217;s website:
<em>wget http://downloads.sourceforge.net/project/libpng/00-libpng-stable/1.2.39/libpng-1.2.39.tar.gz?use_mirror=ncu</em></p>

<p>Uncompress the package:
<em>tar xfz libpng-1.2.39.tar.gz</em></p>

<p>cd to result directory and build it:
<em>cd libpng-1.2.39<br />
./configure<br />
make<br />
make install</em>
<h3>Installing libgd</h3>
gd provides api for programmer to draw images like Graphics2d in java. Gnuplot uses gd to draw charts on images.<br />
Grab source from gd&#8217;s website:
<em>wget http://www.libgd.org/releases/gd-2.0.35.tar.gz</em></p>

<p>Uncompress it:
<em>tar xfz gd-2.0.35.tar.gz</em></p>

<p>build it:
<em>cd gd-2.0.35<br />
./configure<br />
make<br />
make install</em>
<h3>Compiling and building Gnuplot</h3>
Grab source from sourceforge:
<em>wget http://downloads.sourceforge.net/project/gnuplot/gnuplot/4.2.6/gnuplot-4.2.6.tar.gz?use_mirror=ncu</em></p>

<p>Uncompress and compile:
<em>tar xfz gnuplot-4.2.6.tar.gz<br />
cd gnuplot<br />
./configure<br />
make<br />
make install</em></p>

<p>if &#8221;<em>&#8216;@LIBICONV@&#8217; not found</em>&#8221; encountered during make, just edit <em>src/Makefile</em> to replace <em>-l@LIBICONV@</em> to <em>-liconv</em>, and make again.<br />
Try to start gnuplot simply with:
<em>gnuplot</em></p>

<p>Now you may be stopped by error message like<em> libiconv.so.2</em> not found, then you have to copy it from somewhere(such as<em> /usr/local/lib</em>) to<em> /usr/lib</em>, the it will work.
<h3>Using Gnuplot</h3>
As the installation completed, we start to use it.</p>

<p>vmstat is a great utility shows you the status of your process queue, memory, swap, io rates, interrupts and cpu usage. With command-line arguments, we can dump these data in a fixed interval and fixed count:
<em>vmstat 5 10</em></p>

<p>awk is a well-known editor to analyze and extract text from input, we can filter specified fields with awk like this:
<em>vmstat 5 10 | awk &#8216;NR &gt; 2 {print NR-2, $13}&#8217;</em>
The header was ignored by the conditional expression NR&gt;2 which NR stands for Number-of-Row</p>

<p>The output is just enough for gnuplot, now use pipe to connect them together:
<em>vmstat 5 10 | awk &#8216;NR &gt; 2 {print NR, $13}&#8217; | gnuplot -e &#8220;set terminal png; set output &#8216;v.png&#8217;; plot &#8216;-&#8217; u 1:2 t &#8216;cpu&#8217; w linespoints;&#8221;</em></p>

<p>To gather more information at one time, a more complex command is needed:
<em>vmstat 10 360 | awk &#8216;NR &gt; 2 {print NR, $4, $9, $10, $13}&#8217; &gt; vmstat.dat ; gnuplot -e &#8220;set terminal png;set output &#8216;vmstat.png&#8217;;set grid; set multiplot;set size 0.5, 0.5;set origin 0, 0;plot &#8216;vmstat.dat&#8217; u 1:2 t &#8216;freemem&#8217; w linespoints;set size 0.5, 0.5;set origin 0.5, 0;plot &#8216;vmstat.dat&#8217; u 1:3 t &#8216;bi&#8217; w linespoints;set size 0.5, 0.5;set origin 0, 0.5;plot &#8216;vmstat.dat&#8217; u 1:4 t &#8216;bo&#8217; w linespoints;set size 0.5, 0.5;set origin 0.5, 0.5;plot &#8216;vmstat.dat&#8217; u 1:5 t &#8216;cpu&#8217; w linespoints;unset multiplot;&#8221;</em></p>

<p>Unfortunately, gnuplot in Ubuntu jaunty is at version of 4.2.4, which doesn&#8217;t support -e option. So you cannot send gnuplot commands directly in command-line. The solution is split it to several steps:
<em>vmstat 10 360 | awk &#8216;NR &gt; 2 {print NR, $4, $9, $10, $13}&#8217; &gt; vmstat.dat<br />
gnuplot<br />
&gt;set terminal png;<br />
&gt;set output &#8216;vmstat.png&#8217;;<br />
&gt;set grid;<br />
&gt;set multiplot;<br />
&gt;set size 0.5, 0.5;<br />
&gt;set origin 0, 0;<br />
&gt;plot &#8216;vmstat.dat&#8217; u 1:2 t &#8216;freemem&#8217; w linespoints;<br />
&gt;set size 0.5, 0.5;<br />
&gt;set origin 0.5, 0;<br />
&gt;plot &#8216;vmstat.dat&#8217; u 1:3 t &#8216;bi&#8217; w linespoints;<br />
&gt;set size 0.5, 0.5;<br />
&gt;set origin 0, 0.5;plot &#8216;vmstat.dat&#8217; u 1:4 t &#8216;bo&#8217; w linespoints;<br />
&gt;set size 0.5, 0.5;<br />
&gt;set origin 0.5, 0.5;<br />
&gt;plot &#8216;vmstat.dat&#8217; u 1:5 t &#8216;cpu&#8217; w linespoints;<br />
&gt;unset multiplot;</em></p>

<p>This picture is a stat result of performance test this afternoon</p>

<p><img class="alignnone" src="http://pic.yupoo.com/classicning/3794181d957c/medium.jpg" alt="" width="500" height="375" /></p>

<p>For more detailed tutorials, check the article on ibm dw:
<a href="http://www.ibm.com/developerworks/library/l-gnuplot/" target="_blank">http://www.ibm.com/developerworks/library/l-gnuplot/</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sun Ning</span></span>

      








  


<time datetime="2009-09-23T00:00:00+08:00" pubdate data-updated="true">Sep 23<span>rd</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/blog/blog/categories/zhuang-bei/'>装备</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="/blog//twitter.com/share" class="twitter-share-button" data-url="http://sunng87.github.io/blog//blog/2009/09/23/performance-visualization-with-gnuplot/" data-via="Sunng" data-counturl="http://sunng87.github.io/blog//blog/2009/09/23/performance-visualization-with-gnuplot/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/blog/2009/09/22/some-python-segments/" title="Previous Post: Some python segments">&laquo; Some python segments</a>
      
      
        <a class="basic-alignment right" href="/blog/blog/2009/09/24/performance-visualization-with-gnuplot-continued/" title="Next Post: Performance Visualization with Gnuplot, continued">Performance Visualization with Gnuplot, continued &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2013/10/08/delicious-released/">Delicious 发布</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/07/16/four-years-as-programmer/">工作四周年</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/07/05/grunt-for-requirejs-projects/">Grunt for Requirejs Projects</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/06/29/%E7%BB%99-raspberry-pi-%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%98%BE%E7%A4%BA-ip-%E7%9A%84%E6%B6%B2%E6%99%B6%E5%B1%8F/">给 Raspberry Pi 添加一个显示 IP 的液晶屏</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/06/07/%E7%BA%B8%E4%B8%8A%E5%BE%97%E6%9D%A5%E7%BB%88%E8%A7%89%E6%B5%85/">纸上得来终觉浅</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sunng87">@sunng87</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sunng87',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/classicing?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/classicing">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Sun Ning -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sunng-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sunng87.github.io/blog//blog/2009/09/23/performance-visualization-with-gnuplot/';
        var disqus_url = 'http://sunng87.github.io/blog//blog/2009/09/23/performance-visualization-with-gnuplot/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
