
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Here comes the Sun</title>
  <meta name="author" content="Sun Ning">

  
  <meta name="description" content="
">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sunng87.github.io/blog//blog/page/19">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="Here comes the Sun" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Here comes the Sun</a></h1>
  
    <h2>Sun Ning's web log</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sunng87.github.io/blog/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/10/23/when-i-am-64/">When I Am 64</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-23T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.flickr.com/photos/40741608@N08/5106315535/" title="DSC_0007 by 贝小塔, on Flickr"><img src="http://farm2.static.flickr.com/1237/5106315535_07df2a88bc.jpg" width="500" height="335" alt="DSC_0007" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/10/21/exaile-%E8%B1%86%E7%93%A3%E7%94%B5%E5%8F%B0%E6%8F%92%E4%BB%B6-0-0-4/">Exaile 豆瓣电台插件 0.0.4</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-21T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>趁热打铁， Exaile豆瓣电台插件今天又有了一些更新：</p>

<p><ol>
<li>支持今天豆瓣新发布的摇滚、民谣、NewAge频道</li>
<li>支持Exaile 0.3.2开始的界面透明</li>
<li>与官方保持一致，在非个人频道时禁用trash按钮</li>
</ol></p>

<p>下载
<a href="http://github.com/sunng87/exaile-doubanfm-plugin/downloads">http://github.com/sunng87/exaile-doubanfm-plugin/downloads</a></p>

<p>很多朋友纠结于安装，安装确实稍显麻烦，大家注意：
<ol>
<li>确认你的Exaile版本0.3.2。</li>
<li>下载，<strong>重命名下载的文件为doubanfm.tar.gz</strong>（Exaile要求压缩包内的文件名要以压缩包的名字开头，否则报错；而github上使用相同的文件名用作下载会有潜在的问题）</li>
<li>如果已经安装过这个插件，请删除 rm -r ~/.local/share/exaile/plugins/doubanfm</li>
<li>打开Exaile，打开Preferences，到Plugins页，安装</li>
<li>勾选doubanfm</li>
<li>如果plugins树下没有出现Douban Radio，关闭Preferences重开，找到Douban Radio，设置用户名密码</li>
<li>重启Exaile</li>
<li>打开文件菜单，Open Douban.fm，选择你需要的频道</li>
<li><strong>双击音轨或点击播放开始播放</strong></li>
<li>切换到豆瓣视图，菜单View->Doubanfm Mode，或快捷键 Ctrl+alt+d</li>
</ol></p>

<p><a href="http://www.flickr.com/photos/40741608@N08/5101939181/" title="exaile douban radio by 贝小塔, on Flickr"><img src="http://farm2.static.flickr.com/1434/5101939181_949841f861.jpg" width="402" height="142" alt="exaile douban radio" /></a>
Enjoy！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/10/20/%E8%B1%86%E7%93%A3-on-ubuntu/">豆瓣 on Ubuntu</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-20T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>半年来，围绕豆瓣做了几个应用，今天上班路上突然心血来潮，决定汇总一下，推广一下。如果你是豆瓣用户，也是Ubuntu用户，你可以尝试一下。</p>

<p><a href="http://sunng.info/doubantu/">http://sunng.info/doubantu/</a>
<a href="http://www.flickr.com/photos/40741608@N08/5099029491/" title="douban on ubuntu by 贝小塔, on Flickr"><img src="http://farm2.static.flickr.com/1208/5099029491_24b01f5a0a.jpg" width="500" height="361" alt="douban on ubuntu" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/10/17/python-web-%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6-bottle/">Python Web 开发框架 Bottle</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-17T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://bottle.paws.de/">Bottle</a>是一个非常精致的WSGI框架，它提供了Python Web开发中需要的基本支持：URL路由，Request/Response对象封装，模板支持，与WSGI服务器集成支持。整个框架的全部代码约有2000行，它的核心部分没有其他任何依赖，只要有Python环境就可以运行。</p>

<p>Bottle适用于小型的Web开发，在应用程序规模比较小的情况下可以实现快速开发。但是由于自身功能所限，对于大型的Web程序，Bottle的功能略显不足，程序员需要手动管理模块、数据库、配置等等，与Pylons等框架相比Bottle的优势就难以体现出来了。</p>

<p><h3>快速入门</h3>
通过一个简单的、典型的例子描述Bottle的使用：<br />
[cc lang=&#8221;python&#8221;]<br />
from bottle import Bottle, run, mako_view, request</p>

<p>myapp = Bottle()</p>

<p>@myapp.get(&#8216;/hello/:name/:count#&#92;d+#&#8217;)<br />
@mako_view(&#8216;hello&#8217;)<br />
def hello(name, count):<br />
    ip = request.environ.get(&#8216;REMOTE_ADDR&#8217;)<br />
    return dict(n=name, c=int(count), ip=ip)</p>

<p>run(app=myapp)<br />
[/cc]</p>

<p>我们创建一个Bottle对象，通过decorator配置一条路由记录。Bottle的url映射支持具名参数，<i>“/hello/:name/:count#&#92;d+#”</i> 格式的参数，可以匹配<i>/hello/(.+?)/(\d+?)</i>的URL。在方法体中，通过environ字典获得客户端IP，这个操作和其他WSGI框架是一致的。接着通过一个字典类型将Model数据传递给View。View模板通过decorator定义，采用mako模板引擎实现，模板名为hello，他表示在当前目录下一个名叫hello.tpl的文件。</p>

<p><h3>剖析</h3>
Bottle主要可以分成4个模块：
<ul>
<li>Router和WSGI Application</li>
<li>Request和Response, Web helpers</li>
<li>Template Adapters</li>
<li>WSGI Server Adapters</li>
</ul></p>

<p><h4>Router和WSGI Application</h4>
一个Bottle对象是一个标准的WSGI App，这使他可以与很多WSGI Server集成。每个app下管理一个Router用于针对URL映射到handler方法。根据Python decorator的特性，路由规则是在程序启动时自动执行的。</p>

<p>Bottle的route方法用于注册handler到router中。除此以外，还有很多function currying帮助您简单地路由GET / POST 等特定HTTP方法。</p>

<p>Bottle最近以来支持了hook，可以注册一些方法在每个请求之前、或之后执行。</p>

<p>当接受一个HTTP请求时，WSGI Server会调用WSGI App的wsgi方法。它的流程是：</p>

<p><ol>
<li>根据标准的WSGI接口规范，从WSGI environ中生成一个Request对象，初始化一个response对象。</li>
<li>在寻找方法之前，实际上Bottle会自动执行您注册的before_hook。（Bottle._add_hook_wrapper）</li>
<li>根据request.path的URL在router中寻找对应的handler方法（Bottle.match_url, Router.match）。这一步中除了找到合适的handler方法，还要负责提取url中的具名参数，将结果以tuple的形式返回。</li>
<li>以返回的方法和参数，执行handler，获得返回值。</li>
<li>执行所有的after_hooks。</li>
<li> 根据返回的不同类型，写入Response的头部。在这一步，Bottle还会应用一些filter，在Bottle中，filter是用于处理handler返回类型的。例如，一个典型的filter即内置的dict2json，他将handler返回的dict类型自动换成json。（Bottle._cast）</li>
<li>根据返回的HTTP状态码，对handler返回对象进行处理。调用WSGI Server的start_response方法将返回对象写给客户端。</li>
</ol></p>

<p><h4>Request和Response, Web helpers</h4>
Bottle对HTTP的请求和响应封装了Request和Response对象。它采用threadlocal的方式，由Bottle app管理生命周期。您可以在声明handler方法时不必像Java Servlet那样将他们以参数传入，这样增加了方法设计的灵活性，也使得单元测试变得相对轻松。</p>

<p>Request对象是对WSGI environ属性的封装，可以从中取得的属性取决于WSGI Server对<a href="http://www.python.org/dev/peps/pep-0333/#environ-variables">PEP333</a>的实现。</p>

<p>关于Request API，可以参考<a href="http://bottle.paws.de/docs/dev/api.html#bottle.Request">文档</a></p>

<p>类似的，可以参考<a href="http://bottle.paws.de/docs/dev/api.html#bottle.Response">Response API</a>了解如何对HTTP响应进行操作</p>

<p>和很多Web框架一样，你不必手动去设置HTTP重定向，helper方法会简化这些操作：<i>abort</i>, <i>redirect</i>, <i>static_file</i>。当然，你也可以自己创建一些helper。</p>

<p><h4>Template Adapters</h4>
template方法用于渲染视图，您可以使用不同的模板实现：mako, jinja2, cheetah, simpletal以及Bottle自己的简单实现。</p>

<p>view作为一个decorator可以简化模板的选择。与route类似，作者也提供了一些function currying来支持mako_view这样简便的写法。</p>

<p><h4>Server Adapters</h4>
Bottle的Server Adapters简直可以说是WSGI Server的博览会，从这里您可以了解目前比较流行的WSGI实现：
<ul>
<li>flup</li>
<li>wsgiref</li>
<li>cherrypy</li>
<li>paste</li>
<li>fapws3</li>
<li>tornado</li>
<li>Google Appengine</li>
<li>twisted</li>
<li>diesel</li>
<li>meinheld</li>
<li>gunicorn</li>
<li>eventlet</li>
<li>gevent</li>
<li>rocket</li>
</ul></p>

<p>当然，这些不是全部，如果要使用不在其中的WSGI Server，您只需实现一个ServerAdapter的run方法即可，需要做的就是将Bottle app传给server并启动它。</p>

<p>内置的run方法用于启动服务，您还可以指定一个reloader参数使Bottle在后台检查源文件的修改情况，实现热加载。<br />
除了run方式的启动，由于Bottle app本身就是一个符合标准的WSGI app，所以也可以通过一些服务器特有的方式启动服务，例如gunicorn：
<i>gunicorn -w 2 -D -b 127.0.0.1:18080 module:app</i></p>

<p><h3>实战</h3></p>

<p><h4>Middlewares</h4>
Middleware是WSGI的重要概念http://www.python.org/dev/peps/pep-0333/#middleware-components-that-play-both-sides 借助一些成熟的middleware可以添加一些Bottle目前不具备的功能：没错，Session。</p>

<p>Session Middleware最著名的选择叫做Beaker，要其用Beaker，只需要一个装饰器模式的App声明即可，您可以参考Beaker的<a href="http://beaker.groovie.org/configuration.html">文档</a>.</p>

<p>Pylons以使用Middleware著称，而除了Routing这样核心的Middleware，包括Beaker和Authkit都可以应用在Bottle程序上。</p>

<p><h4>App Mounting</h4>
Bottle的App提供一个很有用的mount方法帮助你将Web应用模块化。您可以将一个Bottle App挂载到一个父App上的某个路径，以父App启动后，父App可以为子App在一个路径下提供路由。</p>

<p>不过你会遇到这样的问题：<br />
[cc lang=&#8221;python&#8221;]<br />
child = Bottle()</p>

<p>@child.get(&#8220;/&#8221;)<br />
def hello():<br />
	return &#8220;hello world&#8221;</p>

<p>parent = Bottle()<br />
parent.mount(child, &#8220;/child&#8221;)<br />
[/cc]</p>

<p>很自然的，您希望打开浏览器访问http://localhost:8000/child可能看到hello world，然后却得到404.这个问题不难察觉，于是访问http://localhost:8000/child/，工作正常。</p>

<p>我曾给作者提过这个问题http://github.com/defnull/bottle/issues#issue/88，（补一句，Bottle的作者少有的Nice，对你提出的问题他通常都会认真解答），作者提了一个重定向的方式，不过还是没有决定把它直接加进mount方法里。</p>

<p>那么，我们需要一个新的mount来支持http://localhost:8000/child</p>

<p>[cc lang=&#8221;python&#8221;]<br />
def mount(parent, child, path):<br />
    parent.mount(child, path)<br />
    @parent.get(path)<br />
    def redir():<br />
        redirect(path+&#8221;/&#8221;)<br />
[/cc]</p>

<p><h4>Google AppEngine</h4>
因为有WSGI标准，你可以用Bottle开发Google AppEngine程序。您只需要在handler文件中加入这样的代码即可：<br />
[cc lang=&#8221;python&#8221;]<br />
from google.appengine.ext.webapp.util import run_wsgi_app<br />
def main():<br />
	run_wsgi_app(my_bottle_app)</p>

<p>if __name__ == &#8216;__main__&#8217;:<br />
	main()<br />
[/cc]<br />
依赖？Bottle本身是self-contained，不过你可能还需要一个强大一些的模板引擎来完成你的应用，比如Mako。这样，你需要把依赖和自己的程序一起上传到GAE。对于Mako来说，除了它自己，还依赖marksave，别忘了它。</p>

<p>以上就是我对Bottle的理解和使用心得，希望您在合适的场景下使用Bottle，只有这样，才能感受到这个框架所带来的乐趣。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/10/16/kindle%E5%B7%B2%E8%BF%87%E4%B8%87%E9%87%8D%E5%B1%B1/">Kindle已过万重山</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-16T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><h3>契机。</h3>
早就想买个类似技术的电子书，年初的时候就有过这样的打算，几乎到了只欠东风的节骨眼上，还是畏惧了2000多的高价。事实证明等待是正确的，半年之后，盛大的<a href="http://bambook.sdo.com">Bambook</a>发布了，Kindle3的价格也出来了，从此6寸的电子书都降到了1000人民币以下。情绪逐渐接近临界，开始和samson讨论购买的计划，熟人代购or淘宝代购。不料看到goodtiger率先出手，积聚的能量瞬间爆发。不到24的小时之后，kindle三人组成立了。。。</p>

<p><h3>动机。</h3>
作为城市的低收入群体，我们有责任有义务把钱花到刀刃上。很多人说为神马不买ipad呢，功能强大得多。实际上，我的需求仅限于消费我~/Docuemnt/EBook/目录下永无止尽的文档。在电脑屏幕上，从Adobe Reader，到Simply a reader的<a href="http://projects.gnome.org/evince/">Evince</a>，到more than a reader的<a href="http://okular.kde.org/">Okular</a>，到apvlv，到zathura，即使支持了inverted colors这样的功能，终归还是不能满足舒适看书的需求。OK，只有看书这么简单，甚至你还要防止设备上多余的功能让你在看书的时候分神，你还有其他选择吗？</p>

<p><h3>渠道。</h3>
什么样的渠道让能量毫无顾虑的突破临界呢，当然是<a href="http://pipitu.org/2010/03/10/nexus-one-%E9%A3%98%E6%B4%8B%E8%BF%87%E6%B5%B7%E5%85%A5%E6%89%8B%E8%AE%B0/">有人吃过螃蟹的渠道了</a>。这是一个中继服务，他们为你生成一个美国的地址，你只需要用这个地址在Amazon网站上注册购买，货物会寄到该地址然后转寄到国内你的真实地址。9月7号，我在Amazon网站上pre-order了Kindle3，到了9月17号，Amazon发货；9月20号，包裹到达中继服务的美国地址；支付了国际邮递费用的，9月22号包裹发货，9月23号包裹离开美国。</p>

<p>接下来悲剧就开始了，漫长的纠结的杳无音信，直到9月28号下午，突然收到一个陌生号码发来的短信：您的包裹需要交税！最终还是倒在了之前说的大boss手下。因为短信实在可疑，花了一天核实，到了9月30号下午终于把关税费用打给了对方。接着是漫长的十一假期，继续杳无音信。到了10月8号，终于上班了！打电话到这家公司，结果对方的电话居然坏掉，一接通就是杂音，根本没有办法对话。我心一凉，这回是不是要悲凉了。</p>

<p><h3>实物</h3>
好在这回没有背到那种程度，10月11号毫无征兆地接到快递的电话，我想这事成了！</p>

<p>拿到Kindle，开封。一张简易说明书、一个机器，一根数据线。
<a href="http://www.flickr.com/photos/40741608@N08/5085519950/" title="DSC_0003 by 贝小塔, on Flickr"><img src="http://farm5.static.flickr.com/4091/5085519950_f23acc21f5.jpg" width="500" height="335" alt="DSC_0003" /></a></p>

<p>屏幕效果：
<a href="http://www.flickr.com/photos/40741608@N08/5085548956/" title="DSC_0004 by 贝小塔, on Flickr"><img src="http://farm5.static.flickr.com/4092/5085548956_47cdaaefeb.jpg" width="335" height="500" alt="DSC_0004" /></a></p>

<p>对pdf格式，kindle3虽然原生支持，但是由于pdf本身格式的限制，只能支持到区域缩放，而不支持字体缩放。6寸的屏幕阅读还是有难度的。好在，Amazon提供了格式转换服务，您可以参考<a href="http://blog.samsonis.me/2010/09/update-42-before-kindle-arrives%E2%80%A6/">samson的预习作业</a>把pdf转换成kindle格式。</p>

<p>当然，kindle3内置一个浏览器，如果你能够忍受黑白屏幕和它的屏幕刷新速度，可以尝试一下。
<a href="http://www.flickr.com/photos/40741608@N08/5085043781/" title="DSC_0005 by 贝小塔, on Flickr"><img src="http://farm5.static.flickr.com/4111/5085043781_215ca3fa12.jpg" width="500" height="335" alt="DSC_0005" /></a>
UA显示是Linux操作系统，Webkit核心。</p>

<p><h3>费用</h3>
最后透露一下费用。Kindle3 Wifi的价格是$139，Amazon美国邮递免运费。中继服务国际邮递的费用是$21.79，海关关税190元人民币。最近汇率动荡得厉害，今天的汇率已经是1:6.6405了。总价是<br />
echo &#8220;(139+21.79)*6.6405+190&#8221; | bc<br />
1257.7259</p>

<p>今天看到淘宝上已经有1150的价格了，应该是少了关税。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/10/11/a-fine-day/">A Fine Day</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-11T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>好久没有聊生活了，最近心绪比较杂乱，虽说不像以前那么忙，不过也没像以前那样有时间来贫一下。好在今天倒是这么多年难得的一个顺风日，一切顺利。</p>

<p>上周体检今天出了结果，全部PASS。虽然有一点点心动过速，不过没有大碍。我一直担心的谷丙转氨酶这次终于没有出乱子。其实这半年加班加上压力比较大，有的时候能明显感觉到胸闷，体检之前心里还真没底。不过好在是还年轻，还能顶一顶。尽管是有紧张的因素，但是心动过速也算是个预警吧，以后要加强锻炼。这话不知道说了多少遍了。</p>

<p>另一件事，Kindle终于毫无征兆的到了。9月6号我们kindle三人组（<a href="http://blog.samsonis.me">1</a>，<a href="http://blog.goodtiger.net/">2</a>）通过comgateway订了kindle3，到了9月17号Amazon发货，9月23号从comgateway发货。之后就杳无音信，从comgateway上的跟踪系统看根本就是绝望。结果到了9月28号正在跟samson闲聊的时候，突然收到一条莫名奇妙的短信，说您的货物已经到了北京库到家，要交税，真是又喜又悲。这还没完，花了一天confirm短信的真实性，直到30号中午才把税款打出去。接着就是无尽的国庆假期，漫漫7天过后，迫不及待打电话到库到家，结果8号一天占线，9号好不容易接通了，对方电话却坏了全是杂音跟不听不见说话。说实在的要不是有pipitu先前购物的经验，我这时候就觉得被骗了。好在，好在，今天上午顺丰快递总算是把东西送来了！</p>

<p>有关kindle的细节，过两天再和大家慢慢唠。</p>

<p>今天正好还是妈妈的生日，晚上我们找了一家山西饭馆饱餐一顿，感觉好极了！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/10/08/the-4k-story/">The 4k Story</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-08T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>从 Redis 2.0 开始，Redis的作者就不断地被问道，你为什么要自己造一个VM轮子呢。尽管作者在<a href="http://code.google.com/p/redis/wiki/FAQ#Do_you_plan_to_implement_Virtual_Memory_in_Redis?_Why_don%27t">FAQ</a>里说明了，但是仍然有很多不同意见。</p>

<p>反向代理Varnish的开发人员，Poul-Henning Kamp 写了一篇文章，<a href="http://www.varnish-cache.org/trac/wiki/ArchitectNotes">What&#8217;s wrong with 1975 programming ?</a>，锋芒毕露，矛头直指竞争对手Squid，顺便也打击一大片牵连到了Redis的作者Antirez。他说：
<blockquote>I have spent many years working on the FreeBSD kernel, and only rarely did I venture into userland programming, but when I had occation to do so, I invariably found that people programmed like it was still 1975. </blockquote>
Kamp兄有来到user-space之后一夜回到解放前的感觉，又好像摇晃着饮料瓶子对着Antirez说：你Out啦！也许是因为作者就是个内核开发者，所以Varnish对操作系统的Virtual Memory机制充分信任，把Squid对内存的手动管理称为wasted work。&#8221;So Welcome to Varnish, a 2006 architecture program. &#8221;</p>

<p>还有<a href="http://blog.kennejima.com/post/1226487020/thoughts-on-redis">用户</a>也提出
<blockquote>
Redis doesn’t use OS swap. According to Salvatore Sanfilippo, the creator of Redis, it was because the page size of 4KB was too big. I personally don’t think that helps but it’d be better if Redis preallocated specified amount of buffer pool and bring related objects to the same page to increase locality of reference, instead of letting the heap manager blindly fragment objects. In my opinion, the page size of 32 bytes is too small, considering that the hardware architectures and the compilers are optimized for the conventional page size. In that scale, even the latency of reading something from RAM could be dominant (RAM is too slow for CPU, therefore it’s got L1/L2 cache), and RAM has the pipelined burst mode to pre-fetche memory contents at a few clock cycles, before they are actually requested.
</blockquote></p>

<p>5号，Antirez在博客上写了回击 <a href="http://antirez.com/post/what-is-wrong-with-2006-programming.html">What&#8217;s wrong with 2006 programming?</a>，他认为：
<ul>
<li>OS Swap在一些情况下会导致客户端阻塞</li>
<li>4K大小的Page可能包含很多key，其中总有一些被访问到，导致操作系统无法swap这些page</li>
<li>使用自己实现的Paging为程序提供了极大的自由度，包括作者提到的2.2将会引入的数据压缩、新的数据结构以及自定义的过期算法</li>
</ul></p>

<p>前段时间，Foursquare用MongoDB时，因为Sharding方法一些疏漏把大量的数据集中到了一台机器上，导致一台EC2实例内存耗尽无法工作。Mongodb的内部机制就是mmap，我的同事做过相关的测试，当内存耗尽时，读写操作都使用磁盘，这时mongodb的性能是完全无法使用的。事后10gen的开发人员Horowitz总结出现问题的原因<a href="http://groups.google.com/group/mongodb-user/browse_thread/thread/528a94f287e9d77e">总结出现问题的原因</a>时，其中很重要的一点是
<blockquote>Document size is less than 4k. Such documents, when moved, may be too small to free up pages and, thus, memory. </blockquote></p>

<p>看了这个原因，Redis的作者Twitter上大喜：&#8221;Real world instance of my 4k page + small objects concerns&#8221;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/10/07/douban-on-gwibber-2/">Douban on Gwibber #2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-07T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.flickr.com/photos/40741608@N08/5058425003/" title="Gwibber douban by 贝小塔, on Flickr"><img src="http://farm5.static.flickr.com/4145/5058425003_6bd9c4b6e7.jpg" width="397" height="500" alt="Gwibber douban" /></a></p>

<p>Douban support on gwibber, tested on Gwibber <strong>2.32.0-ubuntu2</strong> or <strong>2.32.0.1-ubuntu1</strong> , Ubuntu Maverick.</p>

<p>You can download it from bitbucket:
<a href="http://bitbucket.org/sunng/gwibber-douban/downloads">http://bitbucket.org/sunng/gwibber-douban/downloads</a></p>

<p>Installation:<br />
Unpack and run install script with super user privilege:
<i>sudo bin/install.sh</i></p>

<p>We will create backup for you. To rollback, just run <i>sudo bin/uninstall.sh</i> .</p>

<p>Any feedback is welcome.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/10/06/rhythmbox-plugin-for-douban-fm/">Rhythmbox Plugin for Douban FM</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-06T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://code.google.com/p/dbfmplugin/">Rhythmbox 豆瓣电台插件</a>是由cdredfox基于<a href="http://github.com/sunng87/exaile-doubanfm-plugin/blob/master/libdoubanfm.py">libdoubanfm</a>开发的另一个Linux桌面豆瓣电台客户端。如果您是Rhythmbox的忠实用户，现在您有一个新的选择了。</p>

<p><image src="http://hnyangfei.appspot.com/media/aglobnlhbmdmZWlyDQsSBU1lZGlhGImbBAw/%E8%96%9B%E5%87%AF%E7%90%AA%20-%20%E5%A4%8D%E5%88%BB%E5%9B%9E%E5%BF%86_007.png" width="500" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2010/10/05/douban-on-gwibber/">Douban on Gwibber</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-05T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Now it&#8217;s possible to use Gwibber as a desktop Douban.</p>

<p>Setup a douban client in the account dialog:
<a href="http://www.flickr.com/photos/40741608@N08/5053311735/" title="GwibberDoubanSetup by 贝小塔, on Flickr"><img src="http://farm5.static.flickr.com/4130/5053311735_5fc69747a5.jpg" width="500" height="259" alt="GwibberDoubanSetup" /></a></p>

<p>Authorize Gwibber to access private data on Douban (OAuth):
<a href="http://www.flickr.com/photos/40741608@N08/5053311377/" title="DoubanOAuthAuthorize by 贝小塔, on Flickr"><img src="http://farm5.static.flickr.com/4147/5053311377_43b0a4788e.jpg" width="500" height="394" alt="DoubanOAuthAuthorize" /></a></p>

<p>Display Douban activities on Gwibber timeline:
<a href="http://www.flickr.com/photos/40741608@N08/5053311635/" title="GwibberDouban by 贝小塔, on Flickr"><img src="http://farm5.static.flickr.com/4103/5053311635_ab6716100b.jpg" width="422" height="500" alt="GwibberDouban" /></a></p>

<p>The code has been uploaded to bitbucket:
<a href="https://bitbucket.org/sunng/gwibber-douban/overview">https://bitbucket.org/sunng/gwibber-douban/overview</a></p>

<p>I am currently working on an installation script.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/blog/page/20/">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/blog/page/18/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>Ning Sun. Programmer. Map enthusiast. (<a href="http://sunng.info/">more</a>)</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2014/07/07/new-android-apps/">Mapzei 和 观察者</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/07/01/extend-linux-ephemeral-ports/">扩展 Linux Ephemeral 端口限制</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/06/09/grouping-in-slacker-0-dot-12/">Slacker Cluster 0.12: Grouping</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/05/27/fork-join-in-papaline/">Fork-Join in Papaline</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/04/20/concurrent-pipeline-with-core-async/">Papaline: Concurrent Pipeline With core.async</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/sunng87">@sunng87</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sunng87',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/classicing?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/classicing">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Sun Ning -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sunng-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
