
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>车水马龙</title>
  <meta name="author" content="Sun Ning">

  
  <meta name="description" content="作为几乎是很多人脑海里南京最北端的地方，燕子矶平时算是人迹罕至。我上一次去这个公园是99年小学毕业的夏天，一晃都已经13年（13年！）过去了。 当年通往燕子矶的小街已经被新修的永济大道取代，不过当时的和平街、临江街依然存在。燕子矶公园的门原本开在临江街上，现在这个门已经几乎倒掉， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sunng87.github.io/blog//blog/page/5">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="车水马龙" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">车水马龙</a></h1>
  
    <h2>here comes the sun</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sunng87.github.io/blog/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/02/18/%E7%87%95%E5%AD%90%E7%9F%B6/">燕子矶</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-18T00:00:00+08:00" pubdate data-updated="true">Feb 18<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>作为几乎是很多人脑海里南京最北端的地方，燕子矶平时算是人迹罕至。我上一次去这个公园是99年小学毕业的夏天，一晃都已经13年（13年！）过去了。</p>

<p>当年通往燕子矶的小街已经被新修的永济大道取代，不过当时的和平街、临江街依然存在。燕子矶公园的门原本开在临江街上，现在这个门已经几乎倒掉，公园在小院的另一侧开了一个面向永济大道的新门。以前这门口是各式拖挂卡车来来往往，环境整治以后现在到公园门口这一段没有卡车，所有的卡车从前面一条小街“新燕街”开到江边的码头。所以万变不离其宗，江边的主题依然是各种大型运输工具。</p>

<p>[mapsmarker marker=&#8221;3&#8221;]</p>

<p>刚到公园门口，就听见有人感叹自己也十年没来这个公园。看来这个公园已经小到、偏到不隔个十多年都想不起他来。然而可贵就可贵在，这么长时间小公园几乎就没有变化。规模小，又有一点特殊的历史背景，再加上有政府的补贴，也不必因为自负盈亏去折腾去影响气氛。说难也难，说简单也简单，就这么无欲无求地保存下来。</p>

<p><a href="http://www.flickr.com/photos/40741608@N08/6895709289/" title="DSC_0004 by 贝小塔, on Flickr"><img src="http://farm8.staticflickr.com/7186/6895709289_7017db7469.jpg" width="500" height="335" alt="DSC_0004" /></a></p>

<p><a href="http://www.flickr.com/photos/40741608@N08/6895702169/" title="DSC_0010 by 贝小塔, on Flickr"><img src="http://farm8.staticflickr.com/7198/6895702169_f23616b13e.jpg" width="335" height="500" alt="DSC_0010" /></a></p>

<p><a href="http://www.flickr.com/photos/40741608@N08/6895706809/" title="DSC_0013 by 贝小塔, on Flickr"><img src="http://farm8.staticflickr.com/7194/6895706809_bb2a000726.jpg" width="335" height="500" alt="DSC_0013" /></a></p>

<p><a href="http://www.flickr.com/photos/40741608@N08/6895704293/" title="DSC_0041 by 贝小塔, on Flickr"><img src="http://farm8.staticflickr.com/7052/6895704293_0aae20c9a5.jpg" width="335" height="500" alt="DSC_0041" /></a></p>

<p><a href="http://www.flickr.com/photos/40741608@N08/6895713699/" title="DSC_0037 by 贝小塔, on Flickr"><img src="http://farm8.staticflickr.com/7184/6895713699_33a202485e.jpg" width="335" height="500" alt="DSC_0037" /></a></p>

<p><a href="http://www.flickr.com/photos/40741608@N08/6895717673/" title="DSC_0028 by 贝小塔, on Flickr"><img src="http://farm8.staticflickr.com/7187/6895717673_35ff2ea296.jpg" width="500" height="332" alt="DSC_0028" /></a></p>

<p><a href="http://www.flickr.com/photos/40741608@N08/6895710599/" title="DSC_0020 by 贝小塔, on Flickr"><img src="http://farm8.staticflickr.com/7052/6895710599_32bf33d76f.jpg" width="309" height="500" alt="DSC_0020" /></a></p>

<p><a href="http://www.flickr.com/photos/40741608@N08/6895715441/" title="DSC_0044 by 贝小塔, on Flickr"><img src="http://farm8.staticflickr.com/7049/6895715441_68bedb5c77.jpg" width="500" height="335" alt="DSC_0044" /></a></p>

<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/02/14/pythons-valentines-day-gift-to-clojure/">Python&#8217;s Valentines Day Gift to Clojure</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-14T00:00:00+08:00" pubdate data-updated="true">Feb 14<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Inspired by meh&#8217;s <a href="https://github.com/meh/ruby-clj" target="_blank">Ruby-Clj</a> module, I created the python equivalent &#8220;pyclj&#8221; last weekend. Pyclj is a clojure literal reader/writer for python. It enables data exchange between python and clojure, in a clojure-native way. It&#8217;s Valentines Day today, I&#8217;d like to release it as the gift of python to clojure :)</p>

<p>The API is very simple. It&#8217;s all like python&#8217;s data modules (json, pickle)</p>

<p>[cc lang=&#8221;python&#8221;]<br />
import clj</p>

<p>clj.loads(&#8220;[1 2 3]&#8221;)<br />
clj.dumps({&#8220;a&#8221;:1, &#8220;b&#8221;:2})<br />
[/cc]</p>

<p>Clojure types are mapping to python data structures :</p>

<p><table border="1">
<tbody><tr>
<th>Clojure</th>
<th>Python</th>
</tr>
<tr>
<td>list</td>
<td>list</td>
</tr>
<tr>
<td>vector</td>
<td>list</td>
</tr>
<tr>
<td>set</td>
<td>set</td>
</tr>
<tr>
<td>map</td>
<td>dict</td>
</tr>
<tr>
<td>nil</td>
<td>None</td>
</tr>
<tr>
<td>string</td>
<td>string</td>
</tr>
<tr>
<td>int</td>
<td>int</td>
</tr>
<tr>
<td>float</td>
<td>float</td>
</tr>
<tr>
<td>boolean</td>
<td>boolean</td>
</tr>
<tr>
<td>char</td>
<td>string</td>
</tr>
<tr>
<td>keyword</td>
<td>string</td>
</tr>
</tbody></table></p>

<p>But how we win clojure&#8217;s heart from ruby? </p>

<p>We are faster.</p>

<p>Considering clojure literal below:<br />
[cc lang=&#8221;clojure&#8221;]<br />
[1 2 3 true false nil {:a 21.3 :b 43.2} &#8220;Hello&#8221;]<br />
[/cc]</p>

<p>Comparing ruby-clj(0.0.4.5, ruby 1.9.3p0) and pyclj(0.1.3 python 2.7.2):<br />
[cc lang=&#8221;ruby&#8221;]<br />
require &#8216;clj&#8217;</p>

<p>s = &#8220;[1 2 3 true false nil {:a 21.3 :b 43.2} &#34;Hello&#34;]&#8221;</p>

<p>t1 = Time.now()<br />
for i in 0&#8230;10000<br />
  Clojure.parse(s)<br />
end<br />
puts Time.now()-t1<br />
[/cc]</p>

<p>[cc lang=&#8221;python&#8221;]<br />
import clj<br />
import time</p>

<p>s = &#8220;[1 2 3 true false nil {:a 21.3 :b 43.2} &#34;Hello&#34;]&#8221;</p>

<p>t1 = time.time()<br />
for i in range(10000):<br />
  clj.loads(s)<br />
print time.time()-t1<br />
[/cc]</p>

<p>The result:<br />
ruby: <del datetime="2012-02-16T05:30:18+00:00"><strong>13.451157809</strong></del>
python: <del datetime="2012-02-16T05:30:18+00:00"><strong>0.712423086166</strong></del>
Edit 20120216 13:30<br />
ruby-clj 0.0.5.3 has resolved the performance issue :) <br />
The new result ruby-clj/0.0.5.4 Vs pyclj0.1.4 (on my laptop):<br />
ruby-clj: 2.044872364<br />
pyclj: 1.19659209251</p>

<p>The project is hosted on <a href="https://github.com/sunng87/pyclj" target="_blank">github</a>. Feel free to join the development and enhance it.</p>

<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/02/11/heatcanvas-performance-enhanced/">HeatCanvas Performance Enhanced</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-11T00:00:00+08:00" pubdate data-updated="true">Feb 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://i.imgur.com/6vkpo.png" alt="heatcanvas" /></p>

<p>时隔半年日日沉浸在clojure世界里的时候，多亏了github上<a href="https://github.com/dazuma">Daniel Azuma</a>的提示，现在HeatCanvas通过Image Data数组来绘制图像。过去由于不太熟悉Canvas API，我用的是fillRect来填充1像素大小的区域，模拟像素的渲染。但是这种方式导致浏览器渲染的效率非常低。</p>

<p>ImageDataArray允许用户开辟一个固定大小的buffer，并设置每一像素的像素值，然后一次性地渲染到canvas上。详情可以参考这里：<a href="https://developer.mozilla.org/En/HTML/Canvas/Pixel_manipulation_with_canvas" target="_blank">Pixel manipulation with canvas</a></p>

<p>这次性能的提升基本没有影响API，唯一的区别是如果原先自定义了value-color的映射函数的话，现在不再接受hsl的css字符串了，新的API需要你返回一个四个元素的数组，分别代表h, s, l, a，值域[0-1]。</p>

<p>感谢关注HeatCanvas的朋友。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/02/09/chinese-clojurians-meeup-2-is-calling-you/">China Clojurians Meetup #2 Is Calling You</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-09T00:00:00+08:00" pubdate data-updated="true">Feb 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>大家期待已久的第二次Clojure中国用户聚会来了，这次聚会将在三月初的北京举行。感兴趣的朋友请猛击<a href="http://www.diaochapai.com/survey/312738f0-cab0-49b0-9f48-18803f79ddf4" target="_blank">这里</a>报名。如果你有任何关于Clojure的心得，都欢迎加入分享，不要害羞～和上次一样本人会继续抛砖继续不害羞，介绍我的RPC框架Slacker。</p>

<p>For English readers:<br />
If you are interested in Clojure and also living in Beijing, feel free to join our meetup. Please register <a href="http://www.diaochapai.com/survey/312738f0-cab0-49b0-9f48-18803f79ddf4" target="_blank">here</a>. We will see you there!
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/02/04/slacker-cluster/">Slacker Cluster</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-04T00:00:00+08:00" pubdate data-updated="true">Feb 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Cluster support is one of the big thing in slacker 0.6.x. Cluster enables high-availability and load balancing on slacker client and server. </p>

<p>Slacker cluster has a centralized registry, a zookeeper node, stores information of all the namespaces and servers instances in the cluster. Once a client declared remote functions, by calling `defn-remote` or `use-remote`, it reads all available servers offering that namespace from the registry and create connection to each of them. We the user issues a request, the client randomly pick up a connection from them. So the load is eventually distributed to every instance of slacker servers. And thanks to zookeeper&#8217;s notification feature, the client watches certain znode. It will be notified when 1. a connected server goes offline 2. a new server serving required namespace added into the cluster. Thus you don&#8217;t have to change client code or restart client when server changes. </p>

<p>To start a slacker server and add it to a cluster, you have to provide cluster information using the new <strong>:cluster</strong> option:<br />
[cc lang=&#8221;clojure&#8221;]<br />
(start-slacker-server (the-ns &#8216;slacker.example.api)<br />
                      2104<br />
                      :cluster {:zk &#8220;127.0.0.1:2181&#8221;<br />
                                :name &#8220;example-cluster&#8221;})<br />
[/cc]</p>

<p><ul>
	<li>:zk is the address of zookeeper node</li>
	<li>:name is a znode qualified string, to identify the cluster</li>
</ul></p>

<p>On the client side, it&#8217;s important to use APIs from `slacker.client.cluster` instead of `slacker.client`:</p>

<p>[cc lang=&#8221;clojure&#8221;]<br />
(use &#8216;slacker.client.cluster)<br />
;; arguments: cluster-name, zookeeper address<br />
(def sc (clustered-slackerc &#8220;example-cluster&#8221; &#8220;127.0.0.1:2181&#8221;))<br />
(use-remote &#8216;sc &#8216;slacker.example.api)</p>

<p>;; call the function from a random server<br />
(timestamp)<br />
[/cc]</p>

<p>If all servers provide &#8216;slacker.example.api go offline, slacker client will raise a &#8220;not-found&#8221; exception.</p>

<p>Slacker cluster is also designed with simple and clean in mind. You don&#8217;t have to change you business code to make it remote or cluster. Everything is transparent and non-invasive. Enjoy it.</p>

<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/02/03/slacker-0-6-exposing-multiple-namespaces/">Slacker 0.6: Exposing Multiple Namespaces</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-03T00:00:00+08:00" pubdate data-updated="true">Feb 3<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After <a href="https://github.com/sunng87/slacker/compare/8b4abdb62a...3e41e035b9" title="Changes">98 commits</a> in about one month, I&#8217;m glad to announce [slacker &#8220;0.6.1&#8221;].</p>

<p>One thing in slacker 0.6.x is you can expose multiple namespaces from a single server.</p>

<p>Suppose you have two namespaces `redday.stats` and `redday.api`, both contains functions you want to expose.</p>

<p>[cc lang=&#8221;clojure&#8221;]<br />
  (start-slacker-server [(the-ns &#8216;redday.stats)<br />
                         (the-ns &#8216;redday.api)]<br />
                        6565)<br />
[/cc]</p>

<p>This will expose `redday.stats` and `redday.api` on port 6565.</p>

<p>On the client side, we have a new `use-remote` behaviors like clojure&#8217;s use. Instead of local one, it imports functions from a remote namespace to your current namespace. </p>

<p>[cc lang=&#8221;clojure&#8221;]<br />
(use &#8216;slacker.client)<br />
;; create a slacker client<br />
(def scp (slackerc &#8220;127.0.0.1:6565&#8221;)) </p>

<p>(use-remote &#8216;scp &#8216;redday.api) ;; caution, use the symbol of &#8216;scp here <br />
(use-remote &#8216;scp &#8216;redday.stats)</p>

<p>;;top-titles is a function in redday.api<br />
;;now you can use the remote function transparently<br />
(top-titles &#8220;programming&#8221;) </p>

<p>;;check function metadata you can find more slacker properties<br />
(meta top-titles)<br />
[/cc]</p>

<p>If you need to configure callback to a particular function, you can still use `defn-remote` to specify the callback function. In slacker 0.6.0, a `:remote-ns` is required when you define such a remote function.<br />
[cc lang=&#8221;clojure&#8221;]<br />
(defn-remote top-titles :remote-ns &#8220;redday.api&#8221; :callback #(println %))<br />
[/cc]</p>

<p>The complete code example (both server and client) can be found <a href="https://bitbucket.org/sunng/slacker-demo/overview">here</a>. </p>

<p>In next post, I will explain another big new feature of 0.6.x, cluster support.</p>

<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/02/01/%E7%88%AC%E5%B1%B1%EF%BC%81/">爬山！</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-01T00:00:00+08:00" pubdate data-updated="true">Feb 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天是2月1号，本人决定从今天开始到月底的每个工作日中午去爬山锻炼身体，以摆脱目前体重极速增长的困局。口说无凭，立此为据。</p>

<p>[mapsmarker marker=&#8221;2&#8221;]</p>

<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/01/24/clojuredocs-android-app/">ClojureDocs Android App</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-24T00:00:00+08:00" pubdate data-updated="true">Jan 24<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>利用春节的假期写了一个Android应用，可以在<a href="http://clojuredocs.org" target="_blank">ClojureDocs.org</a>上搜索clojure API，浏览文档、源代码和社区贡献的代码实例。ClojureDocs在我学习Clojure的过程中起了很大的作用，所以我想这个网站应该对很多人有用。</p>

<p>无暇去学习Android平台上繁琐的知识，不过好在有Phonegap这样的框架，可以把网页应用转化为本地应用，并且提供访问本地设备的API。通过Phonegap开发的程序还可以直接移植到iphone平台上。ClojureDocs Android就是运行在Phonegap中。</p>

<p>首页：
<img src="http://i.imgur.com/zdMCt.png" alt="" /></p>

<p>搜索界面
<img src="http://i.imgur.com/MVCz4.png" alt="" /></p>

<p>API函数界面
<img src="http://i.imgur.com/M0fEI.png" alt="" /></p>

<p>你可以从github获得代码和签名过的apk：<a href="https://github.com/sunng87/clojuredocs-android" target="_blank">https://github.com/sunng87/clojuredocs-android</a></p>

<p>Known Issue，phonegap程序在屏幕旋转时会崩溃，已经在2.3和3.2上重现，目前还不清楚具体的原因。(Edit 20120127: Fixed in 1.0.4)</p>

<p>欢迎任何的pull request。
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/01/19/openstreetmap-nanjing-a-year-of-edits/">OpenStreetMap Nanjing: A Year of Edits</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-19T00:00:00+08:00" pubdate data-updated="true">Jan 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://i.imgur.com/0mVFk.png" alt="osm nanjing" /></p>

<p>这是2011年OpenStreetMap上，南京的编辑情况。高亮的部分是2011年创建或更新的要素。从这张图上可以看出最近的这一年，南京的数据从无到有到逐渐的完善，这里面倾注了本地几位贡献者结结实实的心血。</p>

<p>对这个可视化感兴趣，可以参考<a href="https://gist.github.com/1639915" target="_blank">这里的代码和样式表</a>。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/01/13/clojure-on-cloudfoundry/">Clojure on CloudFoundry</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-13T00:00:00+08:00" pubdate data-updated="true">Jan 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this article, I will show you how to develop and deploy clojure web application on CloudFoundry. As you may know, CloudFoundry is an opensource PaaS backed by VMWare. Java, Ruby and Nodejs are officially supported. As a JVM language, clojure is born to be also available on this platform, although it&#8217;s not listed. </p>

<p>CloudFoundry accepts a .war file for Java web application deployment. So you don&#8217;t need the ring-jetty-adaptor and a procfile as heroku requires. To help your development and deployment, I strongly recommend the lein-ring plugin:</p>

<p>[cc lang=&#8221;clojure&#8221;]<br />
  :dev-dependencies [[lein-ring &#8220;0.5.4&#8221;]]<br />
[/cc]</p>

<p>CloudFoundry provides backend services like mysql, redis, mongodb and more. The connection information are stored as environment variables. <a href="http://env.cloudfoundry.com/env" target="_blank">Here</a> you can find a subset of them. </p>

<p>Take mongodb as example, connection information (host, port, username and password) are encoded as JSON, stored in environment variables. You can get them with this function:<br />
[cc lang=&#8221;clojure&#8221;]<br />
(defn mongo-config [key]<br />
  (if-let [services (System/getenv &#8220;VCAP_SERVICES&#8221;)]<br />
    (let [services-dict (json/read-json services false)]<br />
      (-> services-dict<br />
        (get &#8220;mongodb-1.8&#8221;)<br />
        first<br />
        (get &#8220;credentials&#8221;)<br />
        (get key)))))<br />
[/cc]</p>

<p>In the server bootstrap function, create the mongodb connection:<br />
[cc lang=&#8221;clojure&#8221;]<br />
(defn app-init []<br />
  (def db-conn (make-connection<br />
                 (or (mongo-config &#8220;db&#8221;) &#8220;lazypress&#8221;)<br />
                   :host (or (mongo-config &#8220;hostname&#8221;) &#8220;localhost&#8221;)<br />
                   :port (or (mongo-config &#8220;port&#8221;) 27017)))<br />
  (when-not (nil? (mongo-config &#8220;username&#8221;))<br />
    (authenticate db-conn<br />
      (mongo-config &#8220;username&#8221;)<br />
      (mongo-config &#8220;password&#8221;)))<br />
[/cc]<br />
By adding check for nil, local databased is also supported. This is pretty convenience for local development. These environment variables are consistent on all cloudfoundry application, so it&#8217;s possible to deploy the application on multiple accounts without any changes.</p>

<p>Then you can add your web stuff just like standard clojure web development. (If you are using compojure, place your static files under resource/public.)</p>

<p>Finally, package it. (Suppose your application is named as &#8220;lazypress&#8221;)<br />
[cc lang=&#8221;bash&#8221;]<br />
lein ring uberwar lazypress.war<br />
[/cc]</p>

<p>Use the vmc tool to deploy it:<br />
[cc lang=&#8221;bash&#8221;]<br />
vmc update lazypress<br />
[/cc]</p>

<p>For more usage about the vmc tool, you can read <a href="http://blog.cloudfoundry.com/post/13481010498/simplified-application-deployment-with-cloud-foundry-manifest" target="_blank">this article</a>.</p>

<p>So you have finished deploying your clojure web application to cloudfoundry.</p>

<p>Backed by spring and vmware, cloudfoundry is more Java-friendly than other PaaS like heroku. You don&#8217;t have to start a Java process by yourself (&#8220;lein run&#8221; isn&#8217;t a graceful way to start your app in product environment). And you don&#8217;t have to worry about your web container settings (configure jetty with limited options via ring-jetty-adaptor). All you have to do is package the application as a portable war file, which you can deploy to tomcat, glassfish, and also cloudfoundry. The vmc tool could detect you war file and handle it correctly.</p>

<p></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/blog/page/6/">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/blog/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2014/03/04/slacker-0-dot-11-released/">Slacker Library Updated</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/10/22/swapping-harddisk-without-pain/">Archlinux 梧桐更换硬盘</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/10/08/delicious-released/">Delicious 发布</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/07/16/four-years-as-programmer/">工作四周年</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/07/05/grunt-for-requirejs-projects/">Grunt for Requirejs Projects</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/sunng87">@sunng87</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sunng87',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/classicing?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/classicing">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Sun Ning -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sunng-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
