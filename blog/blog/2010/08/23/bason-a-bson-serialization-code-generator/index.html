
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Bason: A BSON Serialization Code Generator - 车水马龙</title>
  <meta name="author" content="Sun Ning">

  
  <meta name="description" content="Bason is a code generator for object to bson serialization and deserialization. Different from tranditional reflection way, bason uses an annotation &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sunng87.github.io/blog//blog/2010/08/23/bason-a-bson-serialization-code-generator">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="车水马龙" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">车水马龙</a></h1>
  
    <h2>here comes the sun</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sunng87.github.io/blog/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Bason: A BSON Serialization Code Generator</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-23T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Bason is a code generator for object to bson serialization and deserialization. Different from tranditional reflection way, bason uses an annotation processor to generate serialization manager at compile time. You just add Bason as compilation dependency and drop it in the runtime.</p>

<p>To use Bason, you simply add annotation to JavaBeans:<br />
[cc lang=&#8221;java&#8221;]<br />
/**<br />
 *<br />
 */<br />
package info.sunng.bason.example;</p>

<p>import java.util.Date;</p>

<p>import info.sunng.bason.annotations.BsonAlias;<br />
import info.sunng.bason.annotations.BsonDocument;<br />
import info.sunng.bason.annotations.BsonIgnore;</p>

<p>/**<br />
 * @author SunNing<br />
 *<br />
 * @since Aug 18, 2010<br />
 */<br />
@BsonDocument<br />
public class Passenger {</p>

<p>	private double packageWeight;</p>

<p>	private long ticketId;</p>

<p>	private String name;</p>

<p>	private Date createdDate;</p>

<p>	private Flight flight;</p>

<p>	/**<br />
	 * @return the packageWeight<br />
	 */<br />
	@BsonIgnore<br />
	public double getPackageWeight() {<br />
		return packageWeight;<br />
	}</p>

<p>	/**<br />
	 * @param packageWeight the packageWeight to set<br />
	 */<br />
	public void setPackageWeight(double packageWeight) {<br />
		this.packageWeight = packageWeight;<br />
	}</p>

<p>	/**<br />
	 * @return the ticketId<br />
	 */<br />
	@BsonAlias(&#8220;ticket&#8221;)<br />
	public long getTicketId() {<br />
		return ticketId;<br />
	}</p>

<p>	/**<br />
	 * @param ticketId the ticketId to set<br />
	 */<br />
	public void setTicketId(long ticketId) {<br />
		this.ticketId = ticketId;<br />
	}</p>

<p>	/**<br />
	 * @return the name<br />
	 */<br />
	public String getName() {<br />
		return name;<br />
	}</p>

<p>	/**<br />
	 * @param name the name to set<br />
	 */<br />
	public void setName(String name) {<br />
		this.name = name;<br />
	}</p>

<p>	/**<br />
	 * @param createdDate the createdDate to set<br />
	 */<br />
	public void setCreatedDate(Date createdDate) {<br />
		this.createdDate = createdDate;<br />
	}</p>

<p>	/**<br />
	 * @return the createdDate<br />
	 */<br />
	public Date getCreatedDate() {<br />
		return createdDate;<br />
	}</p>

<p>	/**<br />
	 * @param flight the flight to set<br />
	 */<br />
	public void setFlight(Flight flight) {<br />
		this.flight = flight;<br />
	}</p>

<p>	/**<br />
	 * @return the flight<br />
	 */<br />
	public Flight getFlight() {<br />
		return flight;<br />
	}</p>

<p>}</p>

<p>[/cc]
<ul>
<li>@BsonDocument marks this bean to be processed by bason processor. Serialization and deserialization support for this bean will be added to the manager. The bean must follow the Java Bean specification that has a getter and a setter for each property.</li>
<li>@BsonAlias on the getter allows user the specify a name for bson document instead of the default java bean property name.</li>
<li>@BsonIgnore on the getter marks a property to be transient when serialization and deserialization.</li>
</ul></p>

<p>Then you need a <i>bason.properties</i> at the root of classpath which looks like<br />
[cc lang=&#8221;properties&#8221;]<br />
bason.managerClassName=info.sunng.bason.BasonManager<br />
[/cc]<br />
You specify the manager class name here. This name can not be duplicated if you use Bason in multiple modules.</p>

<p>Take maven configuration as an example:<br />
[cc lang=&#8221;xml&#8221;]<br />
	<dependencies>
		<dependency>
			<groupid>info.sunng.bason</groupid>
			<artifactid>bason-annotation</artifactid>
			<scope>compile</scope>
		</dependency>
		<dependency>
			<groupid>info.sunng.bason</groupid>
			<artifactid>bason-internal</artifactid>
			<scope>compile</scope>
		</dependency>
		<dependency>
			<groupid>org.mongodb</groupid>
			<artifactid>mongo-java-driver</artifactid>
		</dependency>
	</dependencies></p>

<p>	<build>
		<finalname>${project.artifactId}</finalname></build></p>

<p>		<plugins>
			<plugin>
				<groupid>org.apache.maven.plugins</groupid>
				<artifactid>maven-compiler-plugin</artifactid></plugin></plugins></p>

<p>				<configuration>
					<source>1.6</source>
					<target>1.6</target></configuration></p>

<p>					<compilerarguments>
						<processor>info.sunng.bason.internal.BasonProcessor</processor>
					</compilerarguments>
				
			
		
	
[/cc]</p>

<p> when everything is ready, run <i>mvn compile</i> to generate the manager source file. By default, in a standard maven project, the generated file will be placed at:
<i>/bason-example/target/generated-sources/annotations/</i>
[cc lang=&#8221;java&#8221;]<br />
package info.sunng.bason;<br />
import org.bson.*;<br />
import javax.annotation.Generated;<br />
@Generated({&#8220;info.sunng.bason.BasonManager&#8221;})<br />
public final class BasonManager{<br />
    public static final BSONObject toBson(info.sunng.bason.example.Passenger o){<br />
        if (o == null) {<br />
            throw new NullPointerException();<br />
        }<br />
        BSONObject bson = new BasicBSONObject();<br />
        bson.put(&#8220;ticket&#8221;,o.getTicketId());<br />
        bson.put(&#8220;name&#8221;,o.getName());<br />
        bson.put(&#8220;createdDate&#8221;,o.getCreatedDate());<br />
        bson.put(&#8220;flight&#8221;,toBson(o.getFlight()));<br />
        return bson;<br />
    }<br />
    public static final info.sunng.bason.example.Passenger fromBson(info.sunng.bason.example.Passenger o, BSONObject bson){<br />
        if (o == null || bson == null) {<br />
            throw new NullPointerException();<br />
        }<br />
        o.setTicketId((java.lang.Long)bson.get(&#8220;ticket&#8221;));<br />
        o.setName((java.lang.String)bson.get(&#8220;name&#8221;));<br />
        o.setCreatedDate((java.util.Date)bson.get(&#8220;createdDate&#8221;));<br />
        o.setFlight(fromBson(new info.sunng.bason.example.Flight(), (BSONObject)bson.get(&#8220;flight&#8221;)));<br />
        return o;<br />
    }<br />
    public static final BSONObject toBson(info.sunng.bason.example.Flight o){<br />
        if (o == null) {<br />
            throw new NullPointerException();<br />
        }<br />
        BSONObject bson = new BasicBSONObject();<br />
        bson.put(&#8220;company&#8221;,o.getCompany());<br />
        bson.put(&#8220;flightId&#8221;,o.getFlightId());<br />
        return bson;<br />
    }<br />
    public static final info.sunng.bason.example.Flight fromBson(info.sunng.bason.example.Flight o, BSONObject bson){<br />
        if (o == null || bson == null) {<br />
            throw new NullPointerException();<br />
        }<br />
        o.setCompany((java.lang.String)bson.get(&#8220;company&#8221;));<br />
        o.setFlightId((java.lang.String)bson.get(&#8220;flightId&#8221;));<br />
        return o;<br />
    }<br />
}</p>

<p>[/cc]</p>

<p>The project is hosted at
<a href="http://github.com/sunng87/bason">http://github.com/sunng87/bason</a></p>

<p>If you have any ideas, just let me know.</p>

<p>The post is brought to you by <a href="http://fedorahosted.org/lekhonee">lekhonee</a> v0.7</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sun Ning</span></span>

      








  


<time datetime="2010-08-23T00:00:00+08:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/blog/categories/ann/'>ANN</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://sunng87.github.io/blog//blog/2010/08/23/bason-a-bson-serialization-code-generator/" data-via="Sunng" data-counturl="http://sunng87.github.io/blog//blog/2010/08/23/bason-a-bson-serialization-code-generator/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/blog/2010/08/19/introduction-to-amoeba/" title="Previous Post: Introduction to Amoeba">&laquo; Introduction to Amoeba</a>
      
      
        <a class="basic-alignment right" href="/blog/blog/2010/08/28/%E5%91%A8%E8%AE%B0/" title="Next Post: 周记">周记 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2014/04/20/rust-concurrent-made-safely/">Rust语言：安全的并发</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/03/04/slacker-0-dot-11-released/">Slacker Library Updated</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/10/22/swapping-harddisk-without-pain/">Archlinux 安全更换硬盘</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/10/08/delicious-released/">Delicious 发布</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/07/16/four-years-as-programmer/">工作四周年</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sunng87">@sunng87</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sunng87',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/classicing?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/classicing">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Sun Ning -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sunng-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sunng87.github.io/blog//blog/2010/08/23/bason-a-bson-serialization-code-generator/';
        var disqus_url = 'http://sunng87.github.io/blog//blog/2010/08/23/bason-a-bson-serialization-code-generator/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
