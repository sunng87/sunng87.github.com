
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Gefr with multiple backends support - 车水马龙</title>
  <meta name="author" content="Sun Ning">

  
  <meta name="description" content="I have been working on gefr this week to add apache MINA backend for it. The goal of gefr is to provide adapters between Python&#8217;s WSGI and Java &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sunng87.github.io/blog//blog/2011/04/09/gefr-with-multiple-backends-support">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="车水马龙" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">车水马龙</a></h1>
  
    <h2>here comes the sun</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sunng87.github.io/blog/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Gefr With Multiple Backends Support</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-09T00:00:00+08:00" pubdate data-updated="true">Apr 9<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I have been working on <a href="https://bitbucket.org/sunng/gefr">gefr</a> this week to add apache MINA backend for it. The goal of gefr is to provide adapters between Python&#8217;s WSGI and Java network infrastructures. In cPython world, most WSGI servers are implemented with C code(fapws, meinheld, etc.), which is not applicable on Jython platform. However, the Java world has its own reliable network foundations. So my gefr turns them into WSGI servers. The ultimate goal of gefr is to make it possible to port any of your WSGI web applications to Jython seamlessly.</p>

<p>There has been many attempts to use Jython in Java web development. Most of them is focusing on applying Jython in Servlet framework. This is helpful, but it doesn&#8217;t take the whole advantage of Python web programming. The most valuable thing in Python web development is its various web frameworks and agile tools. But inside servlet framework, we can hardly apply them, the only things we have is Jython&#8217;s beautiful syntax. That should not be enough.</p>

<p>OK. You are eager to meet gefr?  Let&#8217;s get hands dirty with some setup. I just assume that you have some essential software installed in the right place. Is it true for you?</p>

<p>Create Jython virtual environment:
<font face="monospace">
$ virtualenv -p /usr/local/bin/jython gefr-test<br />
$ cd gefr-test<br />
$ source bin/activate
</font></p>

<p>Install jip. <a href="https://github.com/sunng87/jip">jip</a> is a great tool to manage Java dependencies for your Jython application. jip&gt;=0.3 is required in this guide, and pip will handle this for you.
<font face="monospace">$ pip install jip</font></p>

<p>Install gefr. Since gefr is a pure Python package, pip is still helpful.
<font face="monospace">$ pip install gefr</font></p>

<p>Now create a jip configuration file called <b>.jip</b> in your virtual home. We should add sonatype oss repository.<br />
[cc lang=&#8221;ini&#8221;]<br />
[repos:oss]<br />
uri=http://oss.sonatype.org/content/repositories/snapshots/<br />
type=remote</p>

<p>[repos:central]<br />
uri=http://repo1.maven.org/maven2/<br />
type=remote</p>

<p>[repos:local]<br />
uri=/home/sun/.m2/repository/<br />
type=local<br />
[/cc]</p>

<p>New in jip 0.3, we can use a single command to resolve dependencies of gefr.
<font face="monospace">$ jip install-dependencies info.sunng.gefr:gefr:0.2-SNAPSHOT</font></p>

<p>OK. Then everything is ready. Create your first Jython WSGI application. Actually, there is no difference.<br />
I just copy the example of gefr here, you can find it in the code repository.<br />
[cc lang=&#8221;python&#8221;]<br />
#! /usr/bin/python</p>

<p>__author__=&#8221;Sun Ning <classicning@gmail.com>&#8220;<br />
__date__ =&#8221;$Jan 5, 2011 10:14:27 PM$&#8221;</p>

<p>import sys<br />
from gefr.core import Gefr</p>

<p>def simple(environ, start_response):<br />
    &#8220;&#8221;&#8220;a static app&#8221;&#8220;&#8221;<br />
    headers = []<br />
    headers.append((&#8216;Content-Type&#8217;, &#8220;text/html&#8221;))<br />
    start_response(&#8220;200 OK&#8221;, headers)</p>

<p>    return [&#8221;<h1>it works.</h1>&#8221;]</p>

<p>if __name__ == &#8220;__main__&#8221;:<br />
    from optparse import OptionParser<br />
    parser = OptionParser()<br />
    parser.add_option(&#8216;-b&#8217;, &#8216;&#8211;backend&#8217;, dest=&#8217;backend&#8217;, help=&#8217;server backend&#8217;)<br />
    (options, args) = parser.parse_args()</p>

<p>    if options.backend == &#8216;soldat&#8217;:<br />
        from gefr.backends.soldat import SoldatBackend as backend<br />
    elif options.backend == &#8216;mina&#8217;:<br />
        from gefr.backends.mina import MinaBackend as backend<br />
    else:<br />
        print &#8216;backend %s not supported.&#8217; % options.backend<br />
        sys.exit(1)</p>

<p>    g = Gefr(simple, backend)<br />
    g.start()<br />
[/cc]<br />
With the command line options, you can control which backend to be used. Now start it with:
<font face="monospace">$ jython-all example.py -b soldat</font>
or
<font face="monospace">$ jython-all example.py -b mina</font></p>

<p><a href="https://bitbucket.org/sunng/soldat">Soldat</a> is another network framework written by myself. And MINA, you must know. Open your browser, redirect it to http://localhost:8080 , now you see it works.</p>

<p>Sure, that&#8217;s not enough for your needs. Let&#8217;s have an advanced example. Among all the web frameworks in Python, I like <a href="https://github.com/defnull/bottle">bottle</a> most. So we just build a simple application with GET and POST in bottle.</p>

<p><font face="monospace">$ pip install bottle<br />
$ pip install mako<br />
$ mkdir bottleapp<br />
$ cd bottleapp</font></p>

<p>The bottle application looks like:<br />
echo.py<br />
[cc lang=&#8221;python&#8221;]<br />
# -*- coding:utf-8 -*-</p>

<p>from bottle import Bottle, mako_view, request<br />
from gefr.core import Gefr<br />
from gefr.backends.mina import MinaBackend</p>

<p>bapp = Bottle()</p>

<p>@bapp.get(&#8216;/&#8217;)<br />
@mako_view(&#8216;edit&#8217;)<br />
def display_form():<br />
    return dict(ip=request.environ.get(&#8216;REMOTE_ADDR&#8217;))</p>

<p>@bapp.post(&#8216;/&#8217;)<br />
@mako_view(&#8216;show&#8217;)<br />
def display_content():<br />
    content = request.POST.get(&#8216;content&#8217;)<br />
    return dict(content=content)</p>

<p>Gefr(bapp, MinaBackend).start()<br />
[/cc]</p>

<p>The simple mako templates are:</p>

<p>edit.tpl<br />
[cc lang=&#8221;html&#8221;]
<html>
<head>
    <title>Bottle on MINA</title>
</head>
<body>
    <h1>Bottle on MINA</h1>
    <p>User from ${ip}, leave your words please:</p>
    <form action="/" method="post">
        <textarea cols="60" rows="20" name="content"></textarea>
        <p><input type="submit" /></p>
    </form>
</body>
</html>
[/cc]</p>

<p>show.tpl<br />
[cc lang=&#8221;html&#8221;]
<html>
    <head>
        <title>Bottle on MINA</title>
    </head>
    <body>
        <h1>Bottle on MINA</h1>
        <pre>${content | h}</pre></body></html></p>

<p>    

[/cc]</p>

<p>Start the bottle app:
<font face="monospace">$ jython-all echo.py</font></p>

<p>This is rather simple but it covers the most basic features of a web server.</p>

<p>I should say thank you for reaching here. Gefr is still an experimental project in early development. So there must be bugs and potential performance improvements in it. Feel free to contact me if you are also interested in it. The project is hosted on bitbucket:
<a href="https://bitbucket.org/sunng/gefr">https://bitbucket.org/sunng/gefr</a></classicning@gmail.com><br /><br /><div class="zemanta-pixie"><img class="zemanta-pixie-img" alt="" src="http://img.zemanta.com/pixy.gif?x-id=473ecd63-8d12-88ec-aa8e-ff8244fe6861" /></div></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sun Ning</span></span>

      








  


<time datetime="2011-04-09T00:00:00+08:00" pubdate data-updated="true">Apr 9<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/blog/categories/ann/'>ANN</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="/blog//twitter.com/share" class="twitter-share-button" data-url="http://sunng87.github.io/blog//blog/2011/04/09/gefr-with-multiple-backends-support/" data-via="Sunng" data-counturl="http://sunng87.github.io/blog//blog/2011/04/09/gefr-with-multiple-backends-support/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/blog/2011/04/05/jip-0-2-released/" title="Previous Post: jip 0.2 released">&laquo; jip 0.2 released</a>
      
      
        <a class="basic-alignment right" href="/blog/blog/2011/04/10/enhanced-jip-to-simplify-jython-module-distribution/" title="Next Post: Enhanced jip to simplify Jython module distribution">Enhanced jip to simplify Jython module distribution &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2013/07/05/grunt-for-requirejs-projects/">Grunt for Requirejs Projects</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/06/29/%E7%BB%99-raspberry-pi-%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%98%BE%E7%A4%BA-ip-%E7%9A%84%E6%B6%B2%E6%99%B6%E5%B1%8F/">给 Raspberry Pi 添加一个显示 IP 的液晶屏</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/06/07/%E7%BA%B8%E4%B8%8A%E5%BE%97%E6%9D%A5%E7%BB%88%E8%A7%89%E6%B5%85/">纸上得来终觉浅</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/04/24/checkout-ring-adapter-for-jetty-9/">Checkout Ring Adapter for Jetty 9</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2013/04/12/ann-handlebars-clojure-api/">[ANN] Handlebars Clojure API</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sunng87">@sunng87</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sunng87',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/classicing?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/classicing">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Sun Ning -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sunng-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sunng87.github.io/blog//blog/2011/04/09/gefr-with-multiple-backends-support/';
        var disqus_url = 'http://sunng87.github.io/blog//blog/2011/04/09/gefr-with-multiple-backends-support/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
