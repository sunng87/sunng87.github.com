
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Here comes the Sun</title>
  <meta name="author" content="Sun Ning">

  
  <meta name="description" content="有的朋友看到这标题，肯定感叹，哎呀妈呀，这哥们也堕落了，开始写软文了。好吧，就算是软文吧，我决定东拉西扯地码一些字，不同于上周五的工作指标，这次完全是自觉自愿的。 榕树下，25号，重新上线。 我接触互联网稍微晚了一些，2002年冬天周五的一个下午（不出意外是2002年12月20号）， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sunng87.github.io/blog//blog/page/30">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="Here comes the Sun" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Here comes the Sun</a></h1>
  
    <h2>Sun Ning's web log</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sunng87.github.io/blog/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2009/12/23/%E9%82%A3%E5%B9%B4%E6%A6%95%E6%A0%91%E4%B8%8B/">那年榕树下</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-23T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>有的朋友看到这标题，肯定感叹，哎呀妈呀，这哥们也堕落了，开始写软文了。好吧，就算是软文吧，我决定东拉西扯地码一些字，不同于上周五的工作指标，这次完全是自觉自愿的。</p>

<p>榕树下，25号，重新上线。</p>

<p>我接触互联网稍微晚了一些，2002年冬天周五的一个下午（不出意外是2002年12月20号），家里终于接上了网线。我打开的第一个网站是搜狐，第二个是华军，第三个不记得了。那时已经听说了榕树下，途径大约是每季度一期的贝塔斯曼广告和天天都有的广播小说节目。</p>

<p>贝塔斯曼当时似乎和榕树下还是合作关系，后来收购了榕树下，这也是榕树的不幸。每一期的目录都会有热门的网络小说，那时还都是以榕树下的为主。我记得曾经买过陆幼青的书，红极一时的。</p>

<p>广播每晚十点左右多会有读小说的节目，安妮宝贝的文字常常是DJ们的偏好。到现在具体的内容早就不记得，但是暖暖的感觉还是值得常常温故。</p>

<p>这是我对互联网最初的认识，虽然我那时也不看网络小说，但在印象里，网络小说是互联网生活很重要的一部分。现在要是问我知名的作者我可能几乎都说不上来，但是看到今天网站上列出来那些名字，诸如李寻欢、安妮、宁财神、慕容雪村这样的，还是有一分陌生的熟悉。</p>

<p>有一天，daf同学说她看小说，我说我只知道榕树下。于是顺手搜到已经忘记了的网址，漫长的载入过程还是以一个空白的窗口告终。这些年这种场面也见得多了，没有什么大惊小怪的：大概是太久远了吧。</p>

<p>今天上午看路金波的博客，突然发现榕树下被收购的新闻，转而打开网站，看到了这个让人想流眼泪的<a href="http://www.rongshu.com" target="_blank">页面</a>和这个让人想擦眼泪的<a href="http://58.215.39.134/" target="_blank">留言板</a>。人们对于榕树下的情感，绝不是现在充斥着肾上腺素的起点之流可以相比的。我说这是我加入以来公司做得最好的一件事情，也希望从此榕树下对大家不再只是一些回忆而已。</p>

<p><blockquote><h3>那年榕树下</h3>
词:叶风  曲:马条  演唱:马条<br />
那年榕树下   我们肩头披着细碎阳光<br />
总会有个枝头  将青春安放<br />
那年榕树下  我们亲手种下快乐忧伤<br />
可以要风穿过发梢的那一种飞扬<br />
榕树下  那年萤火虫一样飞舞盘旋<br />
每道光的背后是怎样的世界<br />
榕树下  那年谁其实都在谁的身边<br />
闭上眼的云端 却是秋千<br />
&#8230;&#8230;</blockquote></p>

<p>那年榕树下   我们肩头披着细碎阳光<br />
总会有个枝头  将青春安放<br />
那年榕树下  我们亲手种下快乐忧伤<br />
可以要风穿过发梢的那一种飞扬<br />
榕树下  那年萤火虫一样飞舞盘旋<br />
每道光的背后是怎样的世界<br />
榕树下  那年谁其实都在谁的身边<br />
闭上眼的云端 却是秋千<br />
&#8230;&#8230;<br />
&#8230;&#8230;<br />
榕树下  那年萤火虫一样飞舞盘旋<br />
每道光的背后是怎样的世界<br />
榕树下  那年谁其实都在谁的身边<br />
闭上眼的云端 却是秋千<br />
&#8230;&#8230;<br />
也许只字片语   一个不经意的标点  都能送给曾经些许温暖<br />
&#8230;&#8230;<br />
&#8230;&#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2009/12/22/%E4%B8%8A%E6%B5%B7%E5%9B%BE%E4%B9%A6%E9%A6%86/">上海图书馆</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-22T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>发现南图的资源很不错之后就想着到了上海以后要办一张借书证，眼看住这半年了，险些忘了这件事。上上周六去办证不料比截止时间晚了三分钟，白白跑了一趟。上周六正好约samson去，终于一切顺利。</p>

<p>办证的系统很强大，我第一次见识了二代身份证的高级功能。读卡器可以直接读取身份证里的相应信息，简化填申请表的过程。普通外借功能只需要一年100元押金即可，没有额外的收费。一次可以借5本书，还书的期限是4周。</p>

<p>比较遗憾的是发现在衡山路附近的上图的外借馆非常小，可选的书相对也少。计算机类的书架大约有两个，这个数量和南图是差不多的，但是长度远远没有南图的长，就是说比起南图的外借馆这个规模实在是很可怜。除去一些初级的、质量较低的书，想要刨出理想的计算机图书还是很难的，考虑到这图书馆serve着如此大的一个城市，这也是很正常的，恐怕真要看准时机才能找到目标。</p>

<p>幸运的是这次借到了一直没舍得买的《Unix编程艺术》，当时看到它躺在书架上时几乎是直接抢过来抓在手里的，生怕被别人捷足先登。另外找到一本Jolt获奖的《Code Quality》的译本，也是没翻先拿在手上再说。还有一本《空间数据库》是早先想买但是各大网站纷纷缺货的书，现在拿到有点物是人非的感觉。而另外一本CSS的书是拿回来用来放松的。</p>

<p>临走的时候还拿了一本IBM郭士纳的自传，想来咱也曾经蓝过｜｜｜</p>

<p>有意思的是借书的时候还被搭讪要名片。我就想起年初在南图借书的时候也有意无意地看周围的人手上拿的书，借此推断一个人的技术和背景。</p>

<p>从上图坐1号线一站到常熟路换新开的7号线回张江还是非常方便的，可以避开人多的人民广场站。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2009/12/21/use-yan-in-ruby-web-application/">Using Yan in Ruby Web Application</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I will show you the usage of Yan captcha service. In this tutorial, it&#8217;s based on a simple ruby web application of the Sinatra web framework.</p>

<p>Before we start to use the service, it is necesary to get Yan running. Download the code from <a href="http://bitbucket.org/sunng/yan/" target="_blank">the project page</a>, then build and run it with maven:
<em>mvn jetty:run</em></p>

<p>To enable the application to use Yan, we have to register our application to get an API Key. If you use Yan 0.3, there is a secret registration page at <em>http://localhost:8080/yan/reg.jsp</em> The page is protected by HTTP Basic Authentication, the username and password are store in &#8216;realm.properties&#8217; which is considered to locate in the root directory. Open the file you can see the plain text username and password. If you are running the latest development version, there is no long any UI for API Key creation, but restful interface. This won&#8217;t be hard to you, pickup your tools such as curl or poster (a firefox extension) to send a HTTP request. Take curl as example, do it like this:
<em>curl -X PUT &#8220;http://localhost:8080/yan/apikey/&#8221; -d &#8220;SinatraTestApp&#8221; -u &#8220;username:password&#8221;</em></p>

<p>If it works, you will get a line of json:
<em>{&#8220;apikey&#8221;:&#8221;b251b0dc2eed31cac38555b61d4fa6a453923bfd&#8221;,&#8221;appName&#8221;:&#8221;SinatraTestApp&#8221;}</em>
Save this apikey.</p>

<p>Sinatra is generally considered to be the world&#8217;s lightest and smallest web framework. And our application is rather simple. Just check the code:
<pre class="brush:ruby">require "rubygems"
require "sinatra"
require "net/http"
require "yaml"</pre></p>

<p>apikey=&#8217;b251b0dc2eed31cac38555b61d4fa6a453923bfd&#8217;</p>

<p>get &#8216;/&#8217; do<br />
	conn = Net::HTTP.new(&#8216;localhost&#8217;, 8080)<br />
	q = &#8220;ip=#{@env[&#8216;REMOTE_ADDR&#8217;]}&amp;apikey=#{apikey}&amp;alt=yaml&amp;mode=0&#8221;<br />
	resp, data = conn.get(&#8220;/yan/ticket?#{q}&#8221;)<br />
	@ticket = YAML::load(data)<br />
	haml :sinatra_captcha<br />
end</p>

<p>post &#8216;/&#8217; do<br />
	conn = Net::HTTP.new(&#8216;localhost&#8217;, 8080)<br />
	q = &#8220;ip=#{@env[&#8216;REMOTE_ADDR&#8217;]}&amp;apikey=#{apikey}&amp;key=#{params[&#8216;key&#8217;]}&amp;code=#{params[&#8216;captcha&#8217;]}&#8221;<br />
	resp, data = conn.get(&#8220;/yan/validate?#{q}&#8221;)<br />
	data<br />
end</p>

<p>use_in_file_templates!<br />
__END__</p>

<p>@@ sinatra_captcha<br />
%html<br />
	%head<br />
		%title Yan Captcha on Sinatra<br />
	%body<br />
		%form{:action=&gt;&#8221;/&#8221;, :method=&gt;&#8221;post&#8221;}<br />
			%p<br />
				Username:<br />
				%input{:name=&gt;&#8221;username&#8221;, :type=&gt;&#8221;text&#8221;}<br />
			%p<br />
				Password:<br />
				%input{:name=&gt;&#8221;password&#8221;, :type=&gt;&#8221;password&#8221;}<br />
			%p<br />
				Captcha:<br />
				%img{:src=&gt;@ticket[&#8216;url&#8217;]}<br />
				%br<br />
				%input{:name=&gt;&#8221;captcha&#8221;, :type=&gt;&#8221;text&#8221;}<br />
				%input{:name=&gt;&#8221;key&#8221;, :type=&gt;&#8221;hidden&#8221;, :value=&gt;@ticket[&#8216;key&#8217;]}<br />
				%input{:type=&gt;&#8217;submit&#8217;}

There are two parts of this application: ruby code and haml. I just use in-file-template for convenience. We define a get handler and a post handler on the path &#8216;/&#8217;. The get handler will request a ticket from Yan which contains captcha image url and ticket key. The post handler will extract user input and submit the Yan&#8217;s validator and return user the result. And the HAML code is template for page rendering after GET request.</p>

<p>Maybe you need to install sinatra and some dependency:
<em>sudo gem install sinatra haml</em></p>

<p>Run the code with a build-in WEBrick
<em>ruby sinatra-yan.rb</em></p>

<p>Browse to the default url, test it:</p>

<p><img class="alignnone" src="http://farm3.static.flickr.com/2766/4203612734_3237ed066c_o.png" alt="" width="459" height="268" /></p>

<p>For another similar tutorial using python, check Yan&#8217;s wiki page:
<a href="http://bitbucket.org/sunng/yan/wiki/SampleCode" target="_blank">http://bitbucket.org/sunng/yan/wiki/SampleCode</a></p>

<p>Thank you for your support. btw, today is my dear girl friend&#8217;s birthday, I just wish her happy everyday.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2009/12/20/yan-0-3/">Yan 0.3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-20T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>经过一周的重构和开发，我的开源项目，验证码服务，打上了0.3的tag，算是一个release吧。</p>

<p>This release has been focusing on support for different types captcha generators. Now Yan is not only able to provide image/jpeg captcha, but also text/plain and any others.
<h3>Changeset:</h3>
<ul>
	<li>Internal API Changes:
<ul>
	<li>Cache API improved: new CacheItemIdentity and CacheIdStrategy were introduced in to provide convertion between cache item name and captcha info model;</li>
	<li>Captcha Generator API improved: Add CaptchaGeneratorInfo to define some meta information on captcha providers (such as mode code, captcha type);</li>
	<li>Captcha Data Model(CaptchaInfo) and Ticket Data Model improved: configuration parameters are separated from required parameters and has been more generic for different types of generator algorisms;</li>
</ul>
</li>
	<li>External API Changes:
<ul>
	<li>Rename /image url to /captcha for better literal accuracy;</li>
	<li>/ticket now supports multiple types of applicable format (plain text / json / xml / yaml);</li>
	<li>/ticket now returns the mime type of the captcha generator;</li>
	<li>Add a Simple-Plain-Text generator as a sample for those whose mime type is other than image/jpeg;</li>
</ul>
</li>
	<li>Other changes:
<ul>
	<li>I created a new branch for next version of Yan. So the code in repository now has multiply branches, you can use &#8216;hg update branch-name&#8217; to switch between difference branches;</li>
	<li>The sample test page for the service (index.jsp) has been adopt to the new protocol and totally restyled.</li>
</ul>
</li>
</ul>
<img class="alignnone" src="http://farm3.static.flickr.com/2503/4200328968_b3dd1fee5f.jpg" alt="" width="500" height="391" /></p>

<p>Again, grab code from the development repository:
<em>hg clone https://sunng@bitbucket.org/sunng/yan/</em></p>

<p>If you don&#8217;t use mercurial/hg, you can also download the tagged version from the page:
<a href="http://bitbucket.org/sunng/yan/downloads/" target="_blank"><em>http://bitbucket.org/sunng/yan/downloads/</em></a></p>

<p>Just use maven to resolve dependency, build and run the project:
<em>mvn jetty:run</em></p>

<p>Feel free to report issue :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2009/12/09/a-button-by-gimp/">A Button by GIMP</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-09T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Inspired by a <a href="http://sixrevisions.com/tutorials/web-development-tutorials/create-an-animated-call-to-action-button/" target="_blank">&#8220;Call to action&#8221; tutorial of Photoshop</a>, I&#8217;d like to do the same thing with free and open source software, GIMP.</p>

<p>Before we start the journey, it&#8217;s better to get well prepared. Take a look at the powerful plugin &#8221;<a href="http://registry.gimp.org/node/186" target="_blank">Layer Effects</a>&#8221;. It provides you complete functionality as &#8220;Layer Style&#8221; in Photoshop does which is of critical importance in such kind of image manipulation. Follow the installation guide and I won&#8217;t spend many words about this step.</p>

<p>Open your gimp, create a new canvas with custom size (which makes you feel comfortable)</p>

<p>New a layer, use selection tool to create a rounded rectangle selection area.</p>

<p><img class="alignnone" src="http://farm3.static.flickr.com/2744/4171189572_a6c70c8b00.jpg" alt="" width="500" height="375" /></p>

<p>Fill the selection with gradient color.</p>

<p><img class="alignnone" src="http://farm3.static.flickr.com/2653/4170430801_ee9b8e973d.jpg" alt="" width="500" height="375" /></p>

<p>Resize the canvas. Glow the selection with 3px by menu command &#8220;selection-&gt;glow&#8221;. The crop the canvas by selection using &#8220;image-&gt;crop by selection&#8221;.</p>

<p>Then we apply some layer effects to beauty the button.
<ul>
	<li>layer effects: inner glow, white 75% opacity, size 5</li>
	<li>layer effects: stroke 1px</li>
</ul>
<img src="http://farm3.static.flickr.com/2592/4171189712_2b48af7d78.jpg" alt="" width="500" height="375" /></p>

<p>Place some text on the button such as &#8220;Sign Up&#8221;. Bold sans font(DejaVu sans or Helvetica bold) is recommended here.</p>

<p>Use gradient overlay effect on the text. As the layer effects plugin doesn&#8217;t support gradient overlay on text, we have to do it in a different way. First, create a new layer. Then convert text to selection with context menu command. Gradient fill the selection and hide the original text layer at last. Now we got:</p>

<p><img class="alignnone" src="http://farm3.static.flickr.com/2692/4170430973_8f65b08603.jpg" alt="" width="500" height="375" /></p>

<p>Don&#8217;t stop here. Add layer effects on the new layer:
<ul>
	<li>inner shadow, black, size 2px, distance 2px, angle 90</li>
	<li>drop shadow, light, size 2px, distance 2px, angle 90</li>
</ul>
<img class="alignnone" src="http://farm3.static.flickr.com/2579/4170431039_4eff9b67ff.jpg" alt="" width="500" height="375" /></p>

<p>You can tune the color schema by yourself along the process :)</p>

<p><img class="alignnone" src="http://farm3.static.flickr.com/2765/4171189918_f1ea2c2eff_o.png" alt="" width="170" height="71" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2009/12/06/tikhonov/">Tikhonov</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-06T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>2009年12月4日，苏联功勋演员吉洪诺夫去逝，享年81岁。</p>

<p><img class="alignnone" src="http://farm3.static.flickr.com/2488/4162200310_943fc8b4c3.jpg" alt="" width="500" height="492" /></p>

<p>吉洪诺夫是《春天的十七个瞬间》里施季里茨的扮演者，春天的十七个瞬间是一部70年代的间谍片，或者说电视剧也行，它有12集。吉洪诺夫扮演的是一个非常牛逼的角色，具体有多牛逼，我也不用自己孱弱的表达能力去描述了，如果有一天大家有机会有耐心看完，多少也能够了解。</p>

<p>第一次看《春天的十七个瞬间》是在缤纷多彩的高三暑假，2005年夏天。中央八套每晚十点左右，一天两集，我印象中当时并没有播完，尤其是到了最后变成了缩减版，结尾都没有播全。那是为数不多的我和我妈都能感兴趣的事物，因为播的时间比较晚，通常是第二天我妈来向我了解剧情。现在想起来，这是一段非常值得回忆的时光。</p>

<p>直到现在我还是很容易被老电影里的英雄人物吸引、单纯地敬仰。施季里茨送走普列什聂耳回柏林的路上，在车里睡了十五分钟。旁白大约说道，多年紧张的特工工作使他睡眠的时间可以自己掌握。这个情节印象非常深刻，以至于不断地想起来不断地试图模仿。</p>

<p>那时还没有视频网站，为了能够看全，后来还买了DVD，是我仅有的一套DVD。从头到尾看过三四遍，还在宿舍里和同学一起看过。情节挺慢，能静下来一点一点享受完的机会不多。再，看完这么一部十二集的长片，时间成本上实在不小。不过这不影响我印象深刻，不影响每天上班路上哼电影里的插曲，不影响一个形象留给人的东西。</p>

<p>其实能看到的吉洪诺夫演的电影不多，《春天》和《战争与和平》是其中最有名的，后者可惜我还没有看过。到了苏联解体以后，吉洪诺夫还在米亥科夫的《烈日灼人》里扮演了一个角色。这部电影我看过，但是吉洪诺夫的角色是今天上午才知道，看电影的时候完全没有发觉，因为像“施季里茨也会变老”这样的事实实在是很容易被忽略。</p>

<p>想到这里，我大概不用再写了，因为对于我这样的观众来说，其实吉洪诺夫还有施季里茨们一直都在我们身边。即使走了，也走不远。所以我把标题里的“别了”删掉，祝他们一切都好。
</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/blog/2009/12/06/tikhonov/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2009/11/29/adding-ubuntu-gis-repository/">Adding Ubuntu-GIS Repository</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-29T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在Ubuntu上安装GIS软件，可以添加这个PPA源：<em>
deb http://ppa.launchpad.net/ubuntugis/ubuntugis-unstable/ubuntu karmic main</em></p>

<p>导入GPG KEY
<em>gpg &#8211;keyserver subkeys.pgp.net &#8211;recv 089EBE08314DF160<br />
gpg &#8211;export &#8211;armor 089EBE08314DF160 | sudo apt-key add -</em></p>

<p>这个源中目前包含了最新版本的GIS软件：
<ul>
	<li>gdal 1.6</li>
	<li>grass</li>
	<li>qgis</li>
</ul></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2009/11/27/%E5%9C%A8rhel4%E4%B8%8A%E6%90%AD%E5%BB%BApythonlighttpdfastcgi%E7%8E%AF%E5%A2%83/">在RHEL4上搭建Python/Lighttpd/FastCGI环境</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-27T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在一台赤裸裸的RHEL4上部署web.py程序，一切从几乎是从零开始。以下操作均以root用户操作。
<h2>1. 安装MySQL数据库</h2>
<strong>下载安装MySQL</strong>
<em>wget http://dev.mysql.com/get/Downloads/MySQL-5.1/mysql-5.1.41-linux-i686-glibc23.tar.gz/from/http://mirror.services.wisc.edu/mysql/</em>
解压，按照INSTALL文件说明进行安装，不多赘述
<h2>2. 安装Python环境</h2>
<h3>下载Python源码</h3>
<em>wget http://www.python.org/ftp/python/2.6.4/Python-2.6.4.tar.bz2</em>
解压，编译安装，不需要特殊操作。
<h3>下载Easy_install</h3>
<em>wget http://pypi.python.org/packages/2.6/s/setuptools/setuptools-0.6c11-py2.6.egg</em>
安装
<em>sh setuptools-0.6c11-py2.6.egg</em>
<h3>安装相关Packages</h3>
<em>easy_install DBUtils<br />
easy_install flup<br />
easy_install web.py</em>
<h3>安装mysql-python</h3>
mysql-python包不能用easy_install安装，手动下载
<em>wget http://downloads.sourceforge.net/project/mysql-python/mysql-python-test/1.2.3b1/MySQL-python-1.2.3b1.tar.gz?use_mirror=softlayer</em>
加压，编辑site.cfg<br />
指定mysql_config的路径，注意是新安装的mysql路径
<em>mysql_config=/usr/local/mysql/bin/mysql_config</em>
编译、安装
<em>python setup.py build<br />
python setup.py install</em>
声明libmysqlclient路径
<em>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/mysql/lib</em>
<h2>3. 安装服务器环境</h2>
<h3>下载安装fastcgi头文件</h3>
<em>wget http://www.fastcgi.com/dist/fcgi.tar.gz</em>
解压，默认编译安装
<h3>下载安装PCRE</h3>
<em>wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.00.tar.bz2</em>
解压，默认编译安装
<h3>下载lighttpd</h3>
<em>wget http://download.lighttpd.net/lighttpd/releases-1.4.x/lighttpd-1.4.25.tar.bz2</em>
configure时指定<em>&#8211;prefix=/usr/local/lighttpd</em>
编译，安装
<h2>4. 配置</h2>
lighttpd fastcgi运行web.py程序请参考
<a href="http://www.classicning.com/blog/2009/11/lighttpd%e9%80%9a%e8%bf%87fastcgi%e8%bf%90%e8%a1%8cweb-py%e7%a8%8b%e5%ba%8f/">http://www.classicning.com/blog/2009/11/lighttpd%e9%80%9a%e8%bf%87fastcgi%e8%bf%90%e8%a1%8cweb-py%e7%a8%8b%e5%ba%8f/</a></p>

<p>非常重要的几点注意：
<ul>
	<li>通过fastcgi运行的python脚本必须具有可执行权限，<em> chmod u+x web/main.py</em>；</li>
	<li>重启fastcgi程序需要删除/tmp/fastcgi.socket*</li>
</ul>
任何Python程序出错、权限错误都会导致lighttpd这样的报错：
<em>2009-11-27 18:12:02: (mod_fastcgi.c.1108) child exited with status 13 /home/admin/web/main.py<br />
2009-11-27 18:12:02: (mod_fastcgi.c.1111) If you&#8217;re trying to run your app as a FastCGI backend, make sure you&#8217;re using the FastCGI-enabled version.<br />
If this is PHP on Gentoo, add &#8216;fastcgi&#8217; to the USE flags.<br />
2009-11-27 18:12:02: (mod_fastcgi.c.1399) [ERROR]: spawning fcgi failed.<br />
2009-11-27 18:12:02: (server.c.931) Configuration of plugins failed. Going down.</em></p>

<p>报错会提示fastcgi未正确安装，而实际上仅仅是程序错误或权限问题而已。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2009/11/26/nginx-http-push/">Nginx HTTP Push</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-26T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前些天看到一个Nginx的Module，用来是实现Comet，今天简单试了一下功能。作者名叫Leo Ponomarev，项目地址：http://pushmodule.slact.net/
<h3>安装</h3>
Module需要在编译时加入nginx，同时下载nginx和nginx-push-module，在nginx configure时增加一个参数：
<em>./configure &#8211;add-module=path/to/nginx_http_push_module</em>
<h3>使用</h3>
编写一个非常基本的nginx配置文件：
<pre class="brush:plain">events{
	worker_connections 1024;
}
http{
	server {
		listen	80;
		server_name	localhost;</pre></p>

<p>		location /publish {<br />
			set $push_channel_id $arg_id;</p>

<p>			push_publisher;</p>

<p>			push_store_messages on;<br />
			push_message_timeout 2h;<br />
			push_max_message_buffer_length 10;<br />
			push_min_message_recipients 0;<br />
		}</p>

<p>		location /subscribe{<br />
			push_subscriber;</p>

<p>			push_subscriber_concurrency broadcast;<br />
			set $push_channel_id $arg_id;<br />
			default_type text/plain;<br />
		}</p>

<p>	}<br />
}
一个简单的Server定义了两个路径分别用于publish和subscribe。所有相关的配置项可以在项目主页找到解释，不作赘述。</p>

<p>启动nginx
<em>nginx -c /home/sun/nginxpush/nginx-push.conf</em></p>

<p><em><span style="font-style: normal; background-color: #ffffff;">打开一个终端访问subscribe
<em> curl -X GET http://localhost/subscribe?id=0</em></span></em></p>

<p><span style="background-color: #ffffff;">可以看到HTTP请求被阻塞</span></p>

<p><span style="background-color: #ffffff;">打开另一个终端访问publish
<em> curl -X POST http://localhost/publish?id=0 -d &#8220;Hello World&#8221; </em></span></p>

<p><span style="background-color: #ffffff;">此时subscriber收到字符串&#8221;Hello World&#8221; ，完成HTTP请求。</span></p>

<p><span style="background-color: #ffffff;">subscriber可以通过设置HTTP头来对消息进行过滤，如
<em> curl -X POST http://localhost/publish?id=0 -d &#8220;Hello World&#8221;</em>
<em> curl -X GET http://localhost/subscribe?id=0 &#8211;verbose</em></span>
<div><em>*</em><span style="background-color: #ffffff;"><em> About to connect() to localhost port 80 (#0)</em></span></div>
<div><span style="background-color: #ffffff;"><em>*   Trying 127.0.0.1&#8230; connected</em></span></div>
<div><span style="background-color: #ffffff;"><em>* Connected to localhost (127.0.0.1) port 80 (#0)</em></span></div>
<div><span style="background-color: #ffffff;"><em>&gt; GET /subscribe?id=0 HTTP/1.1</em></span></div>
<div><span style="background-color: #ffffff;"><em>&gt; User-Agent: curl/7.19.7 (i686-pc-linux-gnu) libcurl/7.19.7 OpenSSL/0.9.8l zlib/1.2.3.3</em></span></div>
<div><span style="background-color: #ffffff;"><em>&gt; Host: localhost</em></span></div>
<div><span style="background-color: #ffffff;"><em>&gt; Accept: */*</em></span></div>
<div><span style="background-color: #ffffff;"><em>&gt; </em></span></div>
<div><span style="background-color: #ffffff;"><em>&lt; HTTP/1.1 200 OK</em></span></div>
<div><span style="background-color: #ffffff;"><em>&lt; Server: nginx/0.8.28</em></span></div>
<div><span style="background-color: #ffffff;"><em>&lt; Date: Thu, 26 Nov 2009 09:45:25 GMT</em></span></div>
<div><span style="background-color: #ffffff;"><em>&lt; Content-Type: application/x-www-form-urlencoded</em></span></div>
<div><span style="background-color: #ffffff;"><em>&lt; Content-Length: 10</em></span></div>
<div><span style="background-color: #ffffff;"><em>&lt; Last-Modified: Thu, 26 Nov 2009 09:44:59 GMT</em></span></div>
<div><span style="background-color: #ffffff;"><em>&lt; Connection: keep-alive</em></span></div>
<div><span style="background-color: #ffffff;"><em>&lt; Etag: 0</em></span></div>
<div><span style="background-color: #ffffff;"><em>&lt; Vary: If-None-Match, If-Modified-Since</em></span></div>
<div><span style="background-color: #ffffff;"><em>&lt; </em></span></div>
<div><span style="background-color: #ffffff;"><em>* Connection #0 to host localhost left intact</em></span></div>
<div><span style="background-color: #ffffff;"><em>* Closing connection #0</em></span></div>
<em>HelloWorld</em></p>

<p>从响应的头部可以看到Last-Modified: Thu, 26 Nov 2009 09:44:59 GMT的时间是上一次publish的时间，并且通过Vary字段提示了两个选项
<ul>
	<li>If-None-Match</li>
	<li>If-Modified-Since</li>
</ul>
RFC中对Vary头是这样解释的：</p>

<p>The Vary field value indicates the set of request-header fields that fully determines, while the response is fresh, whether a cache is permitted to use the response to reply to a subsequent request without revalidation.</p>

<p>即可以通过发送If-Modified-Since来获取指定时间之后的数据</p>

<p><em>curl -X GET -H &#8220;If-Modified-Since: Thu, 26 Nov 2009 09:44:50 GMT&#8221; http://localhost/subscribe?id=0 &#8211;verbose</em></p>

<p>这时subscribe会重新被阻塞而不是接收上次publish的数据，充分利用了HTTP的语义。</p>

<p>这样用push module来做Web-IM、聊天室的思路就非常清晰了：<span style="background-color: #ffffff;">每个浏览器保持一个subscriber连接，在接收到消息后连接关闭。把消息打印出来，并根据消息响应的头部Last-Modified请求重新subscribe。</span></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2009/11/23/%E8%BF%99%E4%B8%80%E5%88%87%E6%B2%A1%E6%9C%89%E6%83%B3%E8%B1%A1%E7%9A%84%E9%82%A3%E4%B9%88%E7%B3%9F/">这一切没有想象的那么糟</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-23T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>如果还不算太晚的话，大家抬头看看木星拱月吧，一张笑脸少了一只眼睛。今年这木星和月亮已经腻味了半年了。我倒是清楚记得去年冬天这场面也出现过，那时依稀是火星跟金星，没今天这亮但总归比今天齐全。当然不能太强求完整不是。</p>

<p>我们班刚工作的同学除了在张江的两位都回去考研了，顺利的话60%的大家又要团聚了。我想经历过这半年的同学回去以后肯定有更深刻的体会，我们这个专业找工作阻力很多很大，有的是没办法的事情。现在我又是在旁观者的角度看别人了，冷暖自知，自己的状况，也只有大家自己心里有数。</p>

<p>话说，好久没有码字了，下班一路上想了不少事情，回来写起来却非常吃力，表达能力进一步退化，恶性循环。</p>

<p>又，发现冬天听广播很有感觉，最早听广播还是某个冬天晚上六点半左右电视坏了寻找的替代，一晃今年正好是第十年。至于为什么时间记得这么清楚，呵，因为当时的节目到现在印象还很深。话说现在很多人肯定不能想象，我还有过打热线电话中奖的经历，不过中的什么门票到最后也没用着。那会南京电台还在著名的延龄巷50号，这个难找的地方着实花了我很长时间去领奖。</p>

<p>再，这个月公司也十周年，不过到现在都没看出有什么特别的动静，也没什么可透露的，估计是比不了马云家的大场面的。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/blog/page/31/">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/blog/page/29/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>Ning Sun. Programmer. Map enthusiast. (<a href="http://sunng.info/">more</a>)</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2014/07/08/microservice-and-slacker-cluster/">Clojure Microservice Architecture With Slacker Cluster</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/07/07/new-android-apps/">Mapzei 和 观察者</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/07/01/extend-linux-ephemeral-ports/">扩展 Linux Ephemeral 端口限制</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/06/09/grouping-in-slacker-0-dot-12/">Slacker Cluster 0.12: Grouping</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/05/27/fork-join-in-papaline/">Fork-Join in Papaline</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/sunng87">@sunng87</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sunng87',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/classicing?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/classicing">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Sun Ning -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sunng-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
