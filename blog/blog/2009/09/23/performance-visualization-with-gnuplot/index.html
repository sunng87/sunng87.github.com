<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Performance Visualization With Gnuplot</title>
  <meta name="description" content="Gnuplot is considered to be one of the most famous plotting tools on both linux and windows. With Gnuplot, generation of charts becomes agile and easy. Gnupl...">

  <link rel="stylesheet" href="/blog/css/main.css">
  <link rel="canonical" href="http://sunng.info//blog/blog/2009/09/23/performance-visualization-with-gnuplot/">
  <link rel="alternate" type="application/rss+xml" title="Here comes the Sun" href="http://sunng.info//blog/feed.xml" />
</head>

  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/blog/">Here comes the Sun</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

    </nav>

  </div>

</header>

    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Performance Visualization With Gnuplot</h1>
    <p class="post-meta">Sep 23, 2009</p>
  </header>

  <article class="post-content">
    <p>Gnuplot is considered to be one of the most famous plotting tools on both linux and windows. With Gnuplot, generation of charts becomes agile and easy. Gnuplot supports sorts of terminals range from gui, image to printer. To enable png terminal support, we will build gnuplot with following steps. (However, on most linux distributions you don't have to do these manually, install gnuplot with package manager is doubtlessly the best choice for most cases.)</p>

<p>Well, for a naked machine, it won't be too long to type commands in gnuplot.
<h3>Installing libpng</h3>
linpng provides functionality to write png images.<br />
Grab source form libpng's website:
<em>wget http://downloads.sourceforge.net/project/libpng/00-libpng-stable/1.2.39/libpng-1.2.39.tar.gz?use_mirror=ncu</em></p>

<p>Uncompress the package:
<em>tar xfz libpng-1.2.39.tar.gz</em></p>

<p>cd to result directory and build it:
<em>cd libpng-1.2.39<br />
./configure<br />
make<br />
make install</em>
<h3>Installing libgd</h3>
gd provides api for programmer to draw images like Graphics2d in java. Gnuplot uses gd to draw charts on images.<br />
Grab source from gd's website:
<em>wget http://www.libgd.org/releases/gd-2.0.35.tar.gz</em></p>

<p>Uncompress it:
<em>tar xfz gd-2.0.35.tar.gz</em></p>

<p>build it:
<em>cd gd-2.0.35<br />
./configure<br />
make<br />
make install</em>
<h3>Compiling and building Gnuplot</h3>
Grab source from sourceforge:
<em>wget http://downloads.sourceforge.net/project/gnuplot/gnuplot/4.2.6/gnuplot-4.2.6.tar.gz?use_mirror=ncu</em></p>

<p>Uncompress and compile:
<em>tar xfz gnuplot-4.2.6.tar.gz<br />
cd gnuplot<br />
./configure<br />
make<br />
make install</em></p>

<p>if "<em>'@LIBICONV@' not found</em>" encountered during make, just edit <em>src/Makefile</em> to replace <em>-l@LIBICONV@</em> to <em>-liconv</em>, and make again.<br />
Try to start gnuplot simply with:
<em>gnuplot</em></p>

<p>Now you may be stopped by error message like<em> libiconv.so.2</em> not found, then you have to copy it from somewhere(such as<em> /usr/local/lib</em>) to<em> /usr/lib</em>, the it will work.
<h3>Using Gnuplot</h3>
As the installation completed, we start to use it.</p>

<p>vmstat is a great utility shows you the status of your process queue, memory, swap, io rates, interrupts and cpu usage. With command-line arguments, we can dump these data in a fixed interval and fixed count:
<em>vmstat 5 10</em></p>

<p>awk is a well-known editor to analyze and extract text from input, we can filter specified fields with awk like this:
<em>vmstat 5 10 | awk 'NR &gt; 2 {print NR-2, $13}'</em>
The header was ignored by the conditional expression NR&gt;2 which NR stands for Number-of-Row</p>

<p>The output is just enough for gnuplot, now use pipe to connect them together:
<em>vmstat 5 10 | awk 'NR &gt; 2 {print NR, $13}' | gnuplot -e "set terminal png; set output 'v.png'; plot '-' u 1:2 t 'cpu' w linespoints;"</em></p>

<p>To gather more information at one time, a more complex command is needed:
<em>vmstat 10 360 | awk 'NR &gt; 2 {print NR, $4, $9, $10, $13}' &gt; vmstat.dat ; gnuplot -e "set terminal png;set output 'vmstat.png';set grid; set multiplot;set size 0.5, 0.5;set origin 0, 0;plot 'vmstat.dat' u 1:2 t 'freemem' w linespoints;set size 0.5, 0.5;set origin 0.5, 0;plot 'vmstat.dat' u 1:3 t 'bi' w linespoints;set size 0.5, 0.5;set origin 0, 0.5;plot 'vmstat.dat' u 1:4 t 'bo' w linespoints;set size 0.5, 0.5;set origin 0.5, 0.5;plot 'vmstat.dat' u 1:5 t 'cpu' w linespoints;unset multiplot;"</em></p>

<p>Unfortunately, gnuplot in Ubuntu jaunty is at version of 4.2.4, which doesn't support -e option. So you cannot send gnuplot commands directly in command-line. The solution is split it to several steps:
<em>vmstat 10 360 | awk 'NR &gt; 2 {print NR, $4, $9, $10, $13}' &gt; vmstat.dat<br />
gnuplot<br />
&gt;set terminal png;<br />
&gt;set output 'vmstat.png';<br />
&gt;set grid;<br />
&gt;set multiplot;<br />
&gt;set size 0.5, 0.5;<br />
&gt;set origin 0, 0;<br />
&gt;plot 'vmstat.dat' u 1:2 t 'freemem' w linespoints;<br />
&gt;set size 0.5, 0.5;<br />
&gt;set origin 0.5, 0;<br />
&gt;plot 'vmstat.dat' u 1:3 t 'bi' w linespoints;<br />
&gt;set size 0.5, 0.5;<br />
&gt;set origin 0, 0.5;plot 'vmstat.dat' u 1:4 t 'bo' w linespoints;<br />
&gt;set size 0.5, 0.5;<br />
&gt;set origin 0.5, 0.5;<br />
&gt;plot 'vmstat.dat' u 1:5 t 'cpu' w linespoints;<br />
&gt;unset multiplot;</em></p>

<p>This picture is a stat result of performance test this afternoon</p>

<p><img class="alignnone" src="http://pic.yupoo.com/classicning/3794181d957c/medium.jpg" alt="" width="500" height="375" /></p>

<p>For more detailed tutorials, check the article on ibm dw:
<a href="http://www.ibm.com/developerworks/library/l-gnuplot/" target="_blank">http://www.ibm.com/developerworks/library/l-gnuplot/</a></p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Here comes the Sun</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Here comes the Sun</li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>

  </body>

</html>
