
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Here comes the Sun</title>
  <meta name="author" content="Sun Ning">

  
  <meta name="description" content="After 98 commits in about one month, I&#8217;m glad to announce [slacker &#8220;0.6.1&#8221;]. One thing in slacker 0.6.x is you can expose multiple &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sunng87.github.io/blog//blog/page/6">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="Here comes the Sun" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Here comes the Sun</a></h1>
  
    <h2>Sun Ning's web log</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sunng87.github.io/blog/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/02/03/slacker-0-6-exposing-multiple-namespaces/">Slacker 0.6: Exposing Multiple Namespaces</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-03T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After <a href="https://github.com/sunng87/slacker/compare/8b4abdb62a...3e41e035b9" title="Changes">98 commits</a> in about one month, I&#8217;m glad to announce [slacker &#8220;0.6.1&#8221;].</p>

<p>One thing in slacker 0.6.x is you can expose multiple namespaces from a single server.</p>

<p>Suppose you have two namespaces `redday.stats` and `redday.api`, both contains functions you want to expose.</p>

<p>[cc lang=&#8221;clojure&#8221;]<br />
  (start-slacker-server [(the-ns &#8216;redday.stats)<br />
                         (the-ns &#8216;redday.api)]<br />
                        6565)<br />
[/cc]</p>

<p>This will expose `redday.stats` and `redday.api` on port 6565.</p>

<p>On the client side, we have a new `use-remote` behaviors like clojure&#8217;s use. Instead of local one, it imports functions from a remote namespace to your current namespace. </p>

<p>[cc lang=&#8221;clojure&#8221;]<br />
(use &#8216;slacker.client)<br />
;; create a slacker client<br />
(def scp (slackerc &#8220;127.0.0.1:6565&#8221;)) </p>

<p>(use-remote &#8216;scp &#8216;redday.api) ;; caution, use the symbol of &#8216;scp here <br />
(use-remote &#8216;scp &#8216;redday.stats)</p>

<p>;;top-titles is a function in redday.api<br />
;;now you can use the remote function transparently<br />
(top-titles &#8220;programming&#8221;) </p>

<p>;;check function metadata you can find more slacker properties<br />
(meta top-titles)<br />
[/cc]</p>

<p>If you need to configure callback to a particular function, you can still use `defn-remote` to specify the callback function. In slacker 0.6.0, a `:remote-ns` is required when you define such a remote function.<br />
[cc lang=&#8221;clojure&#8221;]<br />
(defn-remote top-titles :remote-ns &#8220;redday.api&#8221; :callback #(println %))<br />
[/cc]</p>

<p>The complete code example (both server and client) can be found <a href="https://bitbucket.org/sunng/slacker-demo/overview">here</a>. </p>

<p>In next post, I will explain another big new feature of 0.6.x, cluster support.</p>

<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/02/01/%E7%88%AC%E5%B1%B1%EF%BC%81/">爬山！</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-01T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天是2月1号，本人决定从今天开始到月底的每个工作日中午去爬山锻炼身体，以摆脱目前体重极速增长的困局。口说无凭，立此为据。</p>

<p>[mapsmarker marker=&#8221;2&#8221;]</p>

<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/01/24/clojuredocs-android-app/">ClojureDocs Android App</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-24T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>利用春节的假期写了一个Android应用，可以在<a href="http://clojuredocs.org" target="_blank">ClojureDocs.org</a>上搜索clojure API，浏览文档、源代码和社区贡献的代码实例。ClojureDocs在我学习Clojure的过程中起了很大的作用，所以我想这个网站应该对很多人有用。</p>

<p>无暇去学习Android平台上繁琐的知识，不过好在有Phonegap这样的框架，可以把网页应用转化为本地应用，并且提供访问本地设备的API。通过Phonegap开发的程序还可以直接移植到iphone平台上。ClojureDocs Android就是运行在Phonegap中。</p>

<p>首页：
<img src="http://i.imgur.com/zdMCt.png" alt="" /></p>

<p>搜索界面
<img src="http://i.imgur.com/MVCz4.png" alt="" /></p>

<p>API函数界面
<img src="http://i.imgur.com/M0fEI.png" alt="" /></p>

<p>你可以从github获得代码和签名过的apk：<a href="https://github.com/sunng87/clojuredocs-android" target="_blank">https://github.com/sunng87/clojuredocs-android</a></p>

<p>Known Issue，phonegap程序在屏幕旋转时会崩溃，已经在2.3和3.2上重现，目前还不清楚具体的原因。(Edit 20120127: Fixed in 1.0.4)</p>

<p>欢迎任何的pull request。
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/01/19/openstreetmap-nanjing-a-year-of-edits/">OpenStreetMap Nanjing: A Year of Edits</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-19T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://i.imgur.com/0mVFk.png" alt="osm nanjing" /></p>

<p>这是2011年OpenStreetMap上，南京的编辑情况。高亮的部分是2011年创建或更新的要素。从这张图上可以看出最近的这一年，南京的数据从无到有到逐渐的完善，这里面倾注了本地几位贡献者结结实实的心血。</p>

<p>对这个可视化感兴趣，可以参考<a href="https://gist.github.com/1639915" target="_blank">这里的代码和样式表</a>。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/01/13/clojure-on-cloudfoundry/">Clojure on CloudFoundry</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-13T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this article, I will show you how to develop and deploy clojure web application on CloudFoundry. As you may know, CloudFoundry is an opensource PaaS backed by VMWare. Java, Ruby and Nodejs are officially supported. As a JVM language, clojure is born to be also available on this platform, although it&#8217;s not listed. </p>

<p>CloudFoundry accepts a .war file for Java web application deployment. So you don&#8217;t need the ring-jetty-adaptor and a procfile as heroku requires. To help your development and deployment, I strongly recommend the lein-ring plugin:</p>

<p>[cc lang=&#8221;clojure&#8221;]<br />
  :dev-dependencies [[lein-ring &#8220;0.5.4&#8221;]]<br />
[/cc]</p>

<p>CloudFoundry provides backend services like mysql, redis, mongodb and more. The connection information are stored as environment variables. <a href="http://env.cloudfoundry.com/env" target="_blank">Here</a> you can find a subset of them. </p>

<p>Take mongodb as example, connection information (host, port, username and password) are encoded as JSON, stored in environment variables. You can get them with this function:<br />
[cc lang=&#8221;clojure&#8221;]<br />
(defn mongo-config [key]<br />
  (if-let [services (System/getenv &#8220;VCAP_SERVICES&#8221;)]<br />
    (let [services-dict (json/read-json services false)]<br />
      (-> services-dict<br />
        (get &#8220;mongodb-1.8&#8221;)<br />
        first<br />
        (get &#8220;credentials&#8221;)<br />
        (get key)))))<br />
[/cc]</p>

<p>In the server bootstrap function, create the mongodb connection:<br />
[cc lang=&#8221;clojure&#8221;]<br />
(defn app-init []<br />
  (def db-conn (make-connection<br />
                 (or (mongo-config &#8220;db&#8221;) &#8220;lazypress&#8221;)<br />
                   :host (or (mongo-config &#8220;hostname&#8221;) &#8220;localhost&#8221;)<br />
                   :port (or (mongo-config &#8220;port&#8221;) 27017)))<br />
  (when-not (nil? (mongo-config &#8220;username&#8221;))<br />
    (authenticate db-conn<br />
      (mongo-config &#8220;username&#8221;)<br />
      (mongo-config &#8220;password&#8221;)))<br />
[/cc]<br />
By adding check for nil, local databased is also supported. This is pretty convenience for local development. These environment variables are consistent on all cloudfoundry application, so it&#8217;s possible to deploy the application on multiple accounts without any changes.</p>

<p>Then you can add your web stuff just like standard clojure web development. (If you are using compojure, place your static files under resource/public.)</p>

<p>Finally, package it. (Suppose your application is named as &#8220;lazypress&#8221;)<br />
[cc lang=&#8221;bash&#8221;]<br />
lein ring uberwar lazypress.war<br />
[/cc]</p>

<p>Use the vmc tool to deploy it:<br />
[cc lang=&#8221;bash&#8221;]<br />
vmc update lazypress<br />
[/cc]</p>

<p>For more usage about the vmc tool, you can read <a href="http://blog.cloudfoundry.com/post/13481010498/simplified-application-deployment-with-cloud-foundry-manifest" target="_blank">this article</a>.</p>

<p>So you have finished deploying your clojure web application to cloudfoundry.</p>

<p>Backed by spring and vmware, cloudfoundry is more Java-friendly than other PaaS like heroku. You don&#8217;t have to start a Java process by yourself (&#8220;lein run&#8221; isn&#8217;t a graceful way to start your app in product environment). And you don&#8217;t have to worry about your web container settings (configure jetty with limited options via ring-jetty-adaptor). All you have to do is package the application as a portable war file, which you can deploy to tomcat, glassfish, and also cloudfoundry. The vmc tool could detect you war file and handle it correctly.</p>

<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/01/08/weekend-project-lazypress/">Weekend Project: LazyPress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-08T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>发布一个典型的weekend project, 名字叫做<a href="http://lazypress.cloundfoundry.com">LazyPress</a>.顾名思义,这是一个在线的写作系统. 取名Lazy, 除了因为它用Clojure写成,更因为他的简单: 没有繁琐的注册,没有繁琐的分类tag,没有繁琐的格式化,无论是使用还是开发都力求做到最简单.<br />
LazyPress采用Mozilla刚刚发布的<a href="http://browserid.org/">BrowserID</a>. 技术作为账号系统, 用户只需要在首次登录后提供一个ID即可(原本这一步也可以省略, 但是为了保护您的邮箱隐私, 现在需要一个LazyPress专用的ID). 这样LazyPress本身不存储用户的密码,也简化了用户账号管理的代价. BrowserID的登录流程非常简单, 速度也比传统的OpenID和OAuth要快, 用户体验要比多次跳转好很多.<br />
LazyPress使用Markdown进行文本格式化, 简单的编辑器可以支持绝大多数格式的要求. 另外,在浏览器后台LazyPress使用HTML5 LocalStorage技术自动保存用户的文本草稿, 如果用户没有成功发布, 可以在下次浏览器打开时进行恢复.</p>

<p>LazyPress后台存储采用mongodb. 正是mongodb的schema free特性降低了项目功能重构的成本, 促进了人们更快更频繁地优化产品的模型. 这应该是文档型数据库之于传统关系型数据库最大的优势. (犹如git之于svn, 开分支的成本要低得多, 看似是一个普通的功能改进, 实则鼓励促进了开发人员通过开分支实现自己的修改)<br />
LazyPress运行在最近发布的compojure 1.0.0和ring 1.0.0上, 打包为标准的Java web应用直接部署在cloudfoundry上. 前端继续使用的是我偏爱的Mootools库, 因为使用了很多新的浏览器技术, 所以目前只能保证在最新的Firefox和Chromium/Chrome上正常使用.</p>

<p>Fork me on github: <a href="http://github.com/sunng87/lazypress">http://github.com/sunng87/lazypress</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/01/04/slacker-0-4-0-released/">Slacker 0.4.0 Released</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-04T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Slacker 0.4.0 has been released to clojars.org . There are new features and breaking changes in this release.</p>

<p><h3>Breaking Changes</h3></p>

<p><ul>
	<li>New maven coordinator: [slacker &#8220;0.4.0&#8221;] (groupId renamed to slakcer)</li>
	<li>defremote renamed to <strong>defn-remote</strong></li>
	<li>SlackerException removed. slacker now uses slingshot for exception handling</li>
	<li>Rename :async option of defn-remote to <strong>:async?</strong></li></ul></p>

<p></p>

<p><h3>What&#8217;s new in 0.4.0</h3>
<ul>
	<li>Add new serialization type <strong>:clj</strong></li>
	<li>New interceptors: execution time stats, args logger, slow watch dog</li>
	<li>New HTTP interface</li>
	<li>Server inspect commands	</li></ul></p>

<p><li> utility functions/macros <strong>defn-remote-all</strong>, <strong>defn-remote-batch</strong> and <strong>meta-remote</strong></li></p>

<p></p>

<p>Get more information on <a href="https://github.com/sunng87/slacker" target="_blank">github</a>.
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2011/12/31/code-2011/">Code 2011</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-31T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>成功人士是不写总结的，所以我来写个总结。</p>

<p>今年的coding从ABAP开始，这个很多人现在不知道以后也不用知道最好永远也不要知道的语言和他的平台，是一个脱胎于Pascal，在发展过程里又杂糅了SQL和C++的怪物，最后几乎变成了满屏幕关键字。再加上缺乏文档，实在是一段不堪回首的记忆。</p>

<p>3月份开始，我又重新开始了一个python项目叫做<a href="https://github.com/sunng87/jip" target="_blank">jip</a>，他兼容maven，可以与virtualenv和setuptools集成，帮助你解决jython项目的java依赖，简化jython项目的发布，提高工作效率。这个小工具倾注了我不少时间，如果你某一天要和jython打交道的话，可以试试看。</p>

<p>今年还尝试了coffeescript，它恰到好处地消除了javascript里一些ugly的部分，大大提高了编码速度。我用它改写了网站<a href="http://sunng.info/scripts/action.coffee" target="_blank">首页的js</a>。</p>

<p>6月份我又重拾起1年前的javascript库heatcanvas，和<a href="http://nihuajie.com/" target="_blank">lbt05</a>协作完善了程序。通过HTML5的Web worker API改善了渲染canvas时的用户体验，增加了对Google Maps，OpenLayers,Baidu Map以及Leaflet的支持。这个项目的介绍被顶到hackernews的首页，这是一种前所未有的感觉。</p>

<p>7月份开始迎来了一个重大的转折。断断续续学习了一年半的clojure，终于开始写第一个库，<a href="https://github.com/sunng87/reddit.clj" target="_blank">reddit.clj</a>，用clojure封装reddit网站的API。通过这个入口算是真正走进了clojure的世界，七月底reddit.clj基本完成之后我开始写他的第一个应用，<a href="https://github.com/sunng87/rageviewer" target="_blank">rageviewer</a>。这是个clojure的web项目，借着这个契机又接触了compojure和ring。而且写rageviewer的时候恰逢clojurescript公开，一不做二不休，于是这个项目就成了一个full stack的clojure项目：前后端都是clojure。最后rageviewer部署在当时刚刚开始邀请测试的cloudfoundry上。</p>

<p>8月参加了在上海的cn-clojure列表第一次聚会后，我开始用clojure克隆一个已有的并不复杂的程序，当时选择了beanstalkd，一个轻量级的task queue。这个项目取名为<a href="https://github.com/sunng87/clojalk" target="_blank">clojalk</a>。最后它成功地支持了beanstalkd协议的所有命令，支持了通过Write-ahead log做持久化和恢复。这个项目用到了aleph，见识了一把clojure思维下的网络编程。</p>

<p>另外我还帮clojure-control写了一个leiningen的插件，现在这个插件已经合并到clojure-control项目里了。clojure能有这么快的发展，leiningen作为构建工具也有很大的帮助。就好比上半年做jip时，感受到jython的小世界里就没有一个好的方案来同时解决java和python的项目管理问题，而且人们也不重视这个问题。</p>

<p>年底还有一个clojure RPC框架的诞生，这个项目叫做<a href="https://github.com/sunng87/slacker" target="_blank">slacker</a>。项目还没有到总结的时候，我的org file列表上还有一长串的TODO。</p>

<p>总得来说，我觉得今年学习clojure的这个过程很有借鉴价值。对于一个新语言新平台新生态系统，如何入门并且getting real。你可以从一个功能简单的库开始，比如包装一个网站的API，或者（对于clojure来说），包装一个已有的java的库。在完成之后，利用这个库，写一个web应用，进而去了解这个平台上的web开发。再下一步，可以去克隆一个其他平台上的项目，规模不要太大。如此循序渐进，学习的效果很不错。另外，无论做了什么，只要是有用的，就应该说出来，这不仅是自我鼓励，有时候也能找到志同道合的朋友一起参与。</p>

<p>最后除了clojure之外，今年还接着gnome-shell的发布和更新，接触了gnome-shell的gjs扩展开发。又是一个不堪回首的平台，也许是还没有finalize吧，没有任何文档，而且一个平台上的库连变量拼写的风格都不一样！我是不会再浪费时间了，当然，以后的这个<a href="https://extensions.gnome.org/extension/24/exaile-doubanfm-control/" target="_blank">豆瓣电台的control</a>还是会继续跟着gnome-shell的发布一直维护的。</p>

<p>除了上面提到的，今年还尝了一些groovy，common-lisp，甚至octave，不管怎么说都算是一个big year了。但愿明年能把这种状态保持下去，享受这种愉悦。</p>

<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2011/12/29/%E4%BD%BF%E7%94%A8enlive%E4%BD%9C%E4%B8%BA%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/">使用Enlive作为模板引擎</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-29T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在所有的clojure web开发例子里，对模板的介绍都很少。很多的简单例子都是以hiccup作为页面生成的手段。hiccup是个clojure的html DSL，例子里用这样的DSL生成页面确实很酷，可是他是real world吗，当然不是。</p>

<p>好在clojure世界里早就有了enlive，它不仅是一个通过css selector解析html的库，本身也可以作为模板引擎应用在web开发中。我不知道这种通过css selector的方式是否是enlive首创，不过他实在是非常新颖独特，而且平滑了页面设计和程序的集成。</p>

<p>例如这样一个模板 index.html：<br />
[cc lang=&#8221;html&#8221;]
<div id="cc">Sample Text</div>
[/cc]</p>

<p>在clojure程序中，使用enlive的deftemplate<br />
[cc lang=&#8221;clojure&#8221;]<br />
(deftemplate index &#8220;index.html&#8221;<br />
  [ctx]<br />
  [:div#cc] (content (:data ctx)))<br />
[/cc]</p>

<p>在控制器里，可以很MVC地渲染页面<br />
[cc lang=&#8221;clojure&#8221;]<br />
(index {:data &#8220;rendered text&#8221;})<br />
[/cc]</p>

<p>除了content用于渲染文本，还有html-content可以渲染含html标签的内容，以及set-attr用来修改页面元素的属性。</p>

<p>和传统的模板引擎相比，最大的不同是enlive里没有嵌入模板的直观的控制流，没有循环和条件判断，但是并非不可实现。</p>

<p>循环输出一组list</p>

<p>页面 list.html<br />
[cc lang=&#8221;html&#8221;]
<ul id="the-list">
<li class="list-item"></li>
</ul>
[/cc]</p>

<p>定义一个enlive的snippet<br />
[cc lang=&#8221;clojure&#8221;]<br />
(defsnippet item-model &#8220;page.html&#8221; [:.list-item]<br />
  [ctx]<br />
  [:.list-item] (content (:data ctx)))<br />
[/cc]</p>

<p>在页面模板里<br />
[cc lang=&#8221;clojure&#8221;]<br />
(deftemplate list-page &#8220;list.html&#8221;<br />
  [ctx]<br />
  [:ul#the-list] (content (map item-model (:some-list ctx))))<br />
[/cc]</p>

<p>这样在页面里列表项会被循环输出，而在页面设计时这里可以放任意个li，并且直接交给后台作为模板。</p>

<p>条件判断</p>

<p>页面，设计时显示所有的内容 msg.html<br />
[cc lang=&#8221;html&#8221;]
<span id="msg">只在一定条件下显示</span>
[/cc]</p>

<p>在模板中通过clojure的if进行判断<br />
[cc lang=&#8221;clojure&#8221;]<br />
(deftemplate msg &#8220;msg.html&#8221;<br />
  [ctx]<br />
  [:span#msg] (if (:show ctx) identity (html-content &#8220;&#8221;)))<br />
[/cc]</p>

<p>解决了这两个问题，基本上用enlive作为模板引擎就没有障碍了。不过enlive也有一点小问题，其一可能是性能的问题，方便的selector显然要比传统的模板语言消耗更多的CPU。另外，在开发过程里，页面文件在服务器启动后不能热加载，修改页面必须重启ring才能看到。也许有时间的话，可以给它加一个reload选项。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2011/12/24/roar-for-mootools-1-4/">Roar for Mootools 1.4</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-24T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>早在天下大势还处在分久必合的时候，那时候mootools还有不少简单实用的小库，比如我今天搜索&#8221;mootools notification&#8221;就找到这个08年的库叫做<a href="http://digitarald.de/project/roar/" target="_blank">Roar</a>。不过遗憾的是从那以后，这个库就再也没有更新过了。</p>

<p>Mootools本身也沉寂了很久，这个项目恐怕也要思考自己未来的发展方向了。今年9月Mootools迈进了1.4，API上有一些变化。现在的下载页也能看到with/without backward compatibility的版本分开下载。为了用上Roar，我尝试了这两个版本发现都不能使用。最后downgrade到1.2可以确定Roar本身在当时是没有什么问题。</p>

<p>这么多年对mootools痴心不改，所以顺手维护了一下Roar，现在可以在1.4 without compatibility的发布下运行了。主要是几个小修改，大多是一些多年deprecated函数被正式删除：
<ul>
	<li>Type常量，原先的String.type，Object.type现在统一到一个Type对象下，变成Type.isString和Type.isObject</li>
	<li>$empty 常量被删除了，现在直接用function()或Function.from()代替</li>
	<li>$pick 方法被Array.pick取代，参数现在也必须接受数组类型了</li></ul></p>

<p>	<li>$merge 方法被Object.merge取代</li>
	<li>$type 被typeOf取代</li>
	<li>函数对象的create方法被删除了，现在可以用函数对象的bind方法替代</li>
	<li>Browser.Engine 被删除了，需要用其他Browser的API替代</li></p>

<p></p>

<p>修改后的Roar，放在<a href="https://gist.github.com/1516568" target="_blank">这个gist</a>里，测试过可以在firefox和chromium上健康使用。IE没有做测试。这个08年的库，眼看四年过去了，用起来依然不错。</p>

<p>作为mootools的铁杆，我还是会一直专一地坚守下去的。（于是，我也已经变成了多年前那些我眼中为旧事物顽抗到底的老家伙了）</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/blog/page/7/">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/blog/page/5/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>Ning Sun. Programmer. Map enthusiast. (<a href="http://sunng.info/">more</a>)</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2014/07/01/extend-linux-ephemeral-ports/">扩展 Linux Ephemeral 端口限制</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/06/09/grouping-in-slacker-0-dot-12/">Slacker Cluster 0.12: Grouping</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/05/27/fork-join-in-papaline/">Fork-Join in Papaline</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/04/20/concurrent-pipeline-with-core-async/">Papaline: Concurrent Pipeline With core.async</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2014/04/20/rust-concurrent-made-safely/">Rust语言：安全的并发</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/sunng87">@sunng87</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sunng87',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/classicing?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/classicing">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Sun Ning -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sunng-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
